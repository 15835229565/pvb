<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>rllib: rlcanopendaemon.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>rlcanopendaemon.cpp File Reference</h1><code>#include &quot;<a class="el" href="rlcanopendaemon_8cpp_source.html">rlcanopendaemon.h</a>&quot;</code><br/>
<code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &lt;stdlib.h&gt;</code><br/>
<code>#include &lt;string.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="rlthread_8h_source.html">rlthread.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="rlcutil_8h_source.html">rlcutil.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="rlsocket_8h_source.html">rlsocket.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="rlwthread_8h_source.html">rlwthread.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="rlcanopen_8h_source.html">rlcanopen.h</a>&quot;</code><br/>
<div class="dynheader">
Include dependency graph for rlcanopendaemon.cpp:</div>
<div class="dynsection">
<div class="center"><img src="rlcanopendaemon_8cpp__incl.png" border="0" usemap="#rlcanopendaemon_8cpp_map" alt=""/></div>
<map name="rlcanopendaemon_8cpp_map" id="rlcanopendaemon_8cpp">
<area shape="rect" id="node10" href="rlthread_8h.html" title="rlthread.h" alt="" coords="257,83,332,112"/><area shape="rect" id="node17" href="rlwthread_8h.html" title="rlwthread.h" alt="" coords="184,160,269,190"/><area shape="rect" id="node22" href="rlcutil_8h.html" title="rlcutil.h" alt="" coords="1907,83,1971,112"/><area shape="rect" id="node29" href="rlsocket_8h.html" title="rlsocket.h" alt="" coords="117,392,195,422"/><area shape="rect" id="node33" href="rlcanopen_8h.html" title="rlcanopen.h" alt="" coords="356,83,444,112"/><area shape="rect" id="node12" href="rldefine_8h.html" title="rldefine.h" alt="" coords="1029,470,1104,499"/><area shape="rect" id="node36" href="rlcannode_8h.html" title="rlcannode.h" alt="" coords="1020,160,1108,190"/><area shape="rect" id="node49" href="rlcanopenstructs_8h.html" title="rlcanopenstructs.h" alt="" coords="1677,238,1805,267"/><area shape="rect" id="node51" href="rlcanopentypes_8h.html" title="rlcanopentypes.h" alt="" coords="1197,238,1317,267"/><area shape="rect" id="node54" href="rlinifile_8h.html" title="rlinifile.h" alt="" coords="1140,315,1209,344"/><area shape="rect" id="node57" href="rlstring_8h.html" title="rlstring.h" alt="" coords="1155,392,1227,422"/></map>
</div>
<div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dynsection">
<div class="center"><img src="rlcanopendaemon_8cpp__dep__incl.png" border="0" usemap="#rlcanopendaemon_8cppdep_map" alt=""/></div>
</div>

<p><a href="rlcanopendaemon_8cpp_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rlcanopendaemon_8cpp.html#a51ba1765537b52ff4795f6ef0424c690">sdo_read</a> (<a class="el" href="classrlCanOpenDaemon.html">rlCanOpenDaemon</a> *_daemonptr, <a class="el" href="classrlSocket.html">rlSocket</a> *_socket, <a class="el" href="structIPCMSGSTRUCT.html">IPCMSGSTRUCT</a> *_message)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rlcanopendaemon_8cpp.html#addf026270ccb455ee80506d5126ca7a9">sdo_write</a> (<a class="el" href="classrlCanOpenDaemon.html">rlCanOpenDaemon</a> *_daemonptr, <a class="el" href="classrlSocket.html">rlSocket</a> *_socket, <a class="el" href="structIPCMSGSTRUCT.html">IPCMSGSTRUCT</a> *_message)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rlcanopendaemon_8cpp.html#af71b281a73ea060f938e95273f4ddaa1">pdo_receive</a> (<a class="el" href="classrlCanOpenDaemon.html">rlCanOpenDaemon</a> *_daemonptr, <a class="el" href="classrlSocket.html">rlSocket</a> *_socket, <a class="el" href="structIPCMSGSTRUCT.html">IPCMSGSTRUCT</a> *_message)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rlcanopendaemon_8cpp.html#a3d493df597bef31c9bc2654f4bf7d686">pdo_transmit</a> (<a class="el" href="classrlCanOpenDaemon.html">rlCanOpenDaemon</a> *_daemonptr, <a class="el" href="classrlSocket.html">rlSocket</a> *_socket, <a class="el" href="structIPCMSGSTRUCT.html">IPCMSGSTRUCT</a> *_message)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rlcanopendaemon_8cpp.html#a75b08553e4d75c2dc274c9e0f293beab">nmt_transmit</a> (<a class="el" href="classrlCanOpenDaemon.html">rlCanOpenDaemon</a> *_daemonptr, <a class="el" href="classrlSocket.html">rlSocket</a> *_socket, <a class="el" href="structIPCMSGSTRUCT.html">IPCMSGSTRUCT</a> *_message)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rlcanopendaemon_8cpp.html#ac49104ffe6f20c359102f1912dddc2fe">restart_board</a> (<a class="el" href="classrlCanOpenDaemon.html">rlCanOpenDaemon</a> *_daemonptr, <a class="el" href="classrlSocket.html">rlSocket</a> *_socket, <a class="el" href="structIPCMSGSTRUCT.html">IPCMSGSTRUCT</a> *_message)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rlcanopendaemon_8cpp.html#a4d2f8b22b9767bc7b85e24232fcaa76a">getNodeState</a> (<a class="el" href="classrlCanOpenDaemon.html">rlCanOpenDaemon</a> *_daemonptr, <a class="el" href="classrlSocket.html">rlSocket</a> *_socket, <a class="el" href="structIPCMSGSTRUCT.html">IPCMSGSTRUCT</a> *_message)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rlcanopendaemon_8cpp.html#a78046224bc0729596e1af0c721acad79">clientconnection</a> (void *arg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="rlcanopendaemon_8cpp.html#a5f85429028b201fd3ae153c19073e5ac">listenerthread</a> (void *arg)</td></tr>
</table>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a78046224bc0729596e1af0c721acad79"></a><!-- doxytag: member="rlcanopendaemon.cpp::clientconnection" ref="a78046224bc0729596e1af0c721acad79" args="(void *arg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void* clientconnection </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>arg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>handels a new client connection established by listener thread. Saves socket descriptor in new socket object. Runs a loop which reads IPCMSGSTRUCTs containing client requests and calls appropiate handler functions which communicate with the canopen device and send answers back to the client. clientconnection Thread is terminated when client disconnects. </p>

<p>Definition at line <a class="el" href="rlcanopendaemon_8cpp_source.html#l00172">172</a> of file <a class="el" href="rlcanopendaemon_8cpp_source.html">rlcanopendaemon.cpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00173"></a>00173 {
<a name="l00174"></a>00174   <span class="comment">//cout&lt;&lt;&quot;\n client connection established...\n&quot;;</span>
<a name="l00175"></a>00175   
<a name="l00176"></a>00176   <a class="code" href="classrlCanOpenTypes.html" title="class to handle CANopen types">rlCanOpenTypes</a> cifmsg;
<a name="l00177"></a>00177   <a class="code" href="structTHREAD__PARAM.html">THREAD_PARAM</a> *p = (<a class="code" href="structTHREAD__PARAM.html">THREAD_PARAM</a> *) arg;
<a name="l00178"></a>00178   <a class="code" href="structTHREADTRANSFER.html">THREADTRANSFER</a> *tr = (<a class="code" href="structTHREADTRANSFER.html">THREADTRANSFER</a>*)p-&gt;<a class="code" href="structTHREAD__PARAM.html#abb08567308ed25b8bd3329ae84279b3d">user</a>;
<a name="l00179"></a>00179   <a class="code" href="structIPCMSGSTRUCT.html" title="the IPCMSGSTRUCT is the transfer buffer which is send trough TCP sockets">IPCMSGSTRUCT</a> message;
<a name="l00180"></a>00180   <span class="keywordtype">int</span> socketdescr = tr-&gt;<a class="code" href="structTHREADTRANSFER.html#a030472e2b2f26d19e79a38a6597d4f60">socketdescr</a>;
<a name="l00181"></a>00181   <a class="code" href="classrlCanOpenDaemon.html" title="canopen tcp/ip interface for concurrent device-access of multiple clientprocesses...">rlCanOpenDaemon</a> *daemonptr = tr-&gt;<a class="code" href="structTHREADTRANSFER.html#a2d180c880175d6b3d4a98ad5114d6baf">daemonptr</a>;
<a name="l00182"></a>00182   <span class="keywordtype">int</span> ret;
<a name="l00183"></a>00183   <a class="code" href="classrlSocket.html">rlSocket</a> socket(socketdescr);
<a name="l00184"></a>00184   
<a name="l00185"></a>00185   <a class="code" href="rlcutil_8cpp.html#a5380bd2e87ffcf0c8a24c387b0ac7b7b">rlDebugPrintf</a>(<span class="stringliteral">&quot;client connection established...\n&quot;</span>);
<a name="l00186"></a>00186   <span class="keywordflow">while</span>(socket.isConnected())
<a name="l00187"></a>00187   {
<a name="l00188"></a>00188     ret = socket.read((<span class="keywordtype">void</span>*) &amp;message, <span class="keyword">sizeof</span>(message));
<a name="l00189"></a>00189     <span class="keywordflow">if</span>(ret &lt;= 0) <span class="keywordflow">break</span>;
<a name="l00190"></a>00190     <span class="keywordflow">if</span> ((message.msgtype==<a class="code" href="rlcanopendaemon_8h.html#a84e97603720411166b6a7abf45a409f1a08c61a4cef5241dfb8d394e2c4889613">MSG_SDO_READ</a>)&amp;&amp;(message.transfertype==<a class="code" href="rlcanopendaemon_8h.html#a84e97603720411166b6a7abf45a409f1accbcc63bbba40481a04d655b0a97e359">MSG_SEND</a>)){
<a name="l00191"></a>00191       <a class="code" href="rlcanopendaemon_8cpp.html#a51ba1765537b52ff4795f6ef0424c690">sdo_read</a>(daemonptr, &amp;socket, &amp;message);
<a name="l00192"></a>00192     }
<a name="l00193"></a>00193     <span class="keywordflow">if</span> ((message.msgtype==<a class="code" href="rlcanopendaemon_8h.html#a84e97603720411166b6a7abf45a409f1a39ace9ec46bece3742400a7c02854730">MSG_SDO_WRITE</a>)&amp;&amp;(message.transfertype==<a class="code" href="rlcanopendaemon_8h.html#a84e97603720411166b6a7abf45a409f1accbcc63bbba40481a04d655b0a97e359">MSG_SEND</a>)){
<a name="l00194"></a>00194       <a class="code" href="rlcanopendaemon_8cpp.html#addf026270ccb455ee80506d5126ca7a9">sdo_write</a>(daemonptr, &amp;socket, &amp;message);
<a name="l00195"></a>00195     }
<a name="l00196"></a>00196     <span class="keywordflow">if</span> ((message.msgtype==<a class="code" href="rlcanopendaemon_8h.html#a84e97603720411166b6a7abf45a409f1ae1f1be64e42d6e3a25c010e1dd335270">MSG_PDO_RECEIVE</a>)&amp;&amp;(message.transfertype==<a class="code" href="rlcanopendaemon_8h.html#a84e97603720411166b6a7abf45a409f1accbcc63bbba40481a04d655b0a97e359">MSG_SEND</a>)){
<a name="l00197"></a>00197       <a class="code" href="rlcanopendaemon_8cpp.html#af71b281a73ea060f938e95273f4ddaa1">pdo_receive</a>(daemonptr, &amp;socket, &amp;message);
<a name="l00198"></a>00198     }
<a name="l00199"></a>00199     <span class="keywordflow">if</span> ((message.msgtype==<a class="code" href="rlcanopendaemon_8h.html#a84e97603720411166b6a7abf45a409f1afedc0e794922c328a0156660e781f7c0">MSG_PDO_TRANSMIT</a>)&amp;&amp;(message.transfertype==<a class="code" href="rlcanopendaemon_8h.html#a84e97603720411166b6a7abf45a409f1accbcc63bbba40481a04d655b0a97e359">MSG_SEND</a>)){
<a name="l00200"></a>00200       <a class="code" href="rlcanopendaemon_8cpp.html#a3d493df597bef31c9bc2654f4bf7d686">pdo_transmit</a>(daemonptr, &amp;socket, &amp;message);
<a name="l00201"></a>00201     }
<a name="l00202"></a>00202     <span class="keywordflow">if</span> ((message.msgtype==<a class="code" href="rlcanopendaemon_8h.html#a84e97603720411166b6a7abf45a409f1ad29f36968c8e7abcbc93a045777c806e">MSG_NMT_TRANSMIT</a>)&amp;&amp;(message.transfertype==<a class="code" href="rlcanopendaemon_8h.html#a84e97603720411166b6a7abf45a409f1accbcc63bbba40481a04d655b0a97e359">MSG_SEND</a>)){
<a name="l00203"></a>00203       <a class="code" href="rlcanopendaemon_8cpp.html#a75b08553e4d75c2dc274c9e0f293beab">nmt_transmit</a>(daemonptr, &amp;socket, &amp;message);
<a name="l00204"></a>00204     }
<a name="l00205"></a>00205     <span class="keywordflow">if</span> ((message.msgtype==<a class="code" href="rlcanopendaemon_8h.html#a84e97603720411166b6a7abf45a409f1ab5afb59ae93d7d1d5e55f529b7fd37a2">MSG_RESTART_BOARD</a>)&amp;&amp;(message.transfertype==<a class="code" href="rlcanopendaemon_8h.html#a84e97603720411166b6a7abf45a409f1accbcc63bbba40481a04d655b0a97e359">MSG_SEND</a>)){
<a name="l00206"></a>00206       <a class="code" href="rlcanopendaemon_8cpp.html#ac49104ffe6f20c359102f1912dddc2fe">restart_board</a>(daemonptr, &amp;socket, &amp;message);
<a name="l00207"></a>00207     }
<a name="l00208"></a>00208     <span class="keywordflow">if</span> ((message.msgtype==<a class="code" href="rlcanopendaemon_8h.html#a84e97603720411166b6a7abf45a409f1a1e3fa595af5b0fd8f36cd19503a982ef">MSG_GET_NODE_STATE</a>)&amp;&amp;(message.transfertype==<a class="code" href="rlcanopendaemon_8h.html#a84e97603720411166b6a7abf45a409f1accbcc63bbba40481a04d655b0a97e359">MSG_SEND</a>)){
<a name="l00209"></a>00209       <a class="code" href="rlcanopendaemon_8cpp.html#a4d2f8b22b9767bc7b85e24232fcaa76a">getNodeState</a>(daemonptr, &amp;socket, &amp;message);
<a name="l00210"></a>00210     }    
<a name="l00211"></a>00211     
<a name="l00212"></a>00212   }
<a name="l00213"></a>00213   <a class="code" href="rlcutil_8cpp.html#a5380bd2e87ffcf0c8a24c387b0ac7b7b">rlDebugPrintf</a>(<span class="stringliteral">&quot;client disconnect...\n&quot;</span>);
<a name="l00214"></a>00214   <span class="comment">//cout&lt;&lt;&quot;\n client disconnect...\n&quot;;</span>
<a name="l00215"></a>00215   <span class="keywordflow">return</span> NULL;
<a name="l00216"></a>00216 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4d2f8b22b9767bc7b85e24232fcaa76a"></a><!-- doxytag: member="rlcanopendaemon.cpp::getNodeState" ref="a4d2f8b22b9767bc7b85e24232fcaa76a" args="(rlCanOpenDaemon *_daemonptr, rlSocket *_socket, IPCMSGSTRUCT *_message)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void getNodeState </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classrlCanOpenDaemon.html">rlCanOpenDaemon</a> *&nbsp;</td>
          <td class="paramname"> <em>_daemonptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classrlSocket.html">rlSocket</a> *&nbsp;</td>
          <td class="paramname"> <em>_socket</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structIPCMSGSTRUCT.html">IPCMSGSTRUCT</a> *&nbsp;</td>
          <td class="paramname"> <em>_message</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>gets called from clientconnection thread. performs a getNodeState command on the canopen interface. received data is stored in an <a class="el" href="structIPCMSGSTRUCT.html" title="the IPCMSGSTRUCT is the transfer buffer which is send trough TCP sockets">IPCMSGSTRUCT</a> and sent back to the clientprocess </p>

<p>Definition at line <a class="el" href="rlcanopendaemon_8cpp_source.html#l00149">149</a> of file <a class="el" href="rlcanopendaemon_8cpp_source.html">rlcanopendaemon.cpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00151"></a>00151                                          {
<a name="l00152"></a>00152   <span class="keywordtype">int</span> returnvalue;
<a name="l00153"></a>00153   <a class="code" href="classrlCanOpenTypes.html" title="class to handle CANopen types">rlCanOpenTypes</a> cifmsg;
<a name="l00154"></a>00154   cifmsg.<a class="code" href="classrlCanOpenTypes.html#a9f3e044c60558bd0de010434241c9824" title="overwrites all data with IPCMSGSTRUCT data">getIpcMsg</a>(*_message);
<a name="l00155"></a>00155   _daemonptr-&gt;<a class="code" href="classrlCanOpenDaemon.html#a0ba207ed336015b1ec56340aa1ffebce">daemon_thread</a>.<a class="code" href="classrlThread.html#a543d60a27fdd4362af6a859049e19f52">lock</a>();
<a name="l00156"></a>00156     returnvalue=_daemonptr-&gt;<a class="code" href="classrlCanOpenDaemon.html#ad32a3078d59a83504a752ced7bf9642c">nodes</a>-&gt;<a class="code" href="classrlCanOpen.html#aef2160067fb768dc63c038fa0abc0f4d" title="use this function to get information about a specific node">getNodeState</a>(_message-&gt;<a class="code" href="structIPCMSGSTRUCT.html#a3e9d17de9492c78203c3ca6881faf6ab">boardid</a>,
<a name="l00157"></a>00157                                                 _message-&gt;<a class="code" href="structIPCMSGSTRUCT.html#a2acd50bbd96927117ea43f82e1fa8705">nodeid</a>, 
<a name="l00158"></a>00158                                                 cifmsg);
<a name="l00159"></a>00159   _daemonptr-&gt;<a class="code" href="classrlCanOpenDaemon.html#a0ba207ed336015b1ec56340aa1ffebce">daemon_thread</a>.<a class="code" href="classrlThread.html#ab52388712ba58b879ea1f0ceca547ad3">unlock</a>();
<a name="l00160"></a>00160   *_message = cifmsg.<a class="code" href="classrlCanOpenTypes.html#af59141fc2073831833333cd48214d878" title="returns a IPCMSGSTRUCT filled with current object data">createIpcMsg</a>();
<a name="l00161"></a>00161   _message-&gt;<a class="code" href="structIPCMSGSTRUCT.html#a4c97b4f1dbf03de0358f3bc45ba527a0">msgtype</a>=<a class="code" href="rlcanopendaemon_8h.html#a84e97603720411166b6a7abf45a409f1a1e3fa595af5b0fd8f36cd19503a982ef">MSG_GET_NODE_STATE</a>; _message-&gt;<a class="code" href="structIPCMSGSTRUCT.html#aeabf16c705c41f39549f37b1341fcd40">transfertype</a>=returnvalue;
<a name="l00162"></a>00162   _socket-&gt;<a class="code" href="classrlSocket.html#aa069e328b2509cbbc15bf9c91684b6be">write</a>((<span class="keywordtype">void</span>*) _message, <span class="keyword">sizeof</span>(*_message));   
<a name="l00163"></a>00163 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5f85429028b201fd3ae153c19073e5ac"></a><!-- doxytag: member="rlcanopendaemon.cpp::listenerthread" ref="a5f85429028b201fd3ae153c19073e5ac" args="(void *arg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void* listenerthread </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>arg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>listenerthread waits for incoming client connections on the confugured port and spawns a new clientthread for each of them. </p>

<p>Definition at line <a class="el" href="rlcanopendaemon_8cpp_source.html#l00221">221</a> of file <a class="el" href="rlcanopendaemon_8cpp_source.html">rlcanopendaemon.cpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00222"></a>00222 {
<a name="l00223"></a>00223   
<a name="l00224"></a>00224   <span class="comment">// socketdescriptor;</span>
<a name="l00225"></a>00225   <span class="keywordtype">int</span> socketdescr;
<a name="l00226"></a>00226   <span class="comment">// parameter struct for accessing function parameters</span>
<a name="l00227"></a>00227   <a class="code" href="structTHREAD__PARAM.html">THREAD_PARAM</a> *p = (<a class="code" href="structTHREAD__PARAM.html">THREAD_PARAM</a> *) arg;
<a name="l00228"></a>00228   <span class="comment">// new parameter struct for passing parameters to handler thread</span>
<a name="l00229"></a>00229   <a class="code" href="structTHREADTRANSFER.html">THREADTRANSFER</a> tr;
<a name="l00230"></a>00230   <a class="code" href="classrlCanOpenDaemon.html" title="canopen tcp/ip interface for concurrent device-access of multiple clientprocesses...">rlCanOpenDaemon</a> *daemonptr = (<a class="code" href="classrlCanOpenDaemon.html" title="canopen tcp/ip interface for concurrent device-access of multiple clientprocesses...">rlCanOpenDaemon</a>*) p-&gt;<a class="code" href="structTHREAD__PARAM.html#abb08567308ed25b8bd3329ae84279b3d">user</a>;
<a name="l00231"></a>00231   tr.<a class="code" href="structTHREADTRANSFER.html#a2d180c880175d6b3d4a98ad5114d6baf">daemonptr</a> = daemonptr;
<a name="l00232"></a>00232   <span class="keywordtype">int</span> port = daemonptr-&gt;<a class="code" href="classrlCanOpenDaemon.html#a2700fe9d6dbf7950319ef744b391a527">getPort</a>();
<a name="l00233"></a>00233   <span class="comment">// wait for connections with accept();</span>
<a name="l00234"></a>00234   <a class="code" href="rlcutil_8cpp.html#a5380bd2e87ffcf0c8a24c387b0ac7b7b">rlDebugPrintf</a>(<span class="stringliteral">&quot;\n starting listener on port %d...\n&quot;</span>, port);
<a name="l00235"></a>00235   <span class="comment">// initialize socket with daemonport</span>
<a name="l00236"></a>00236   <a class="code" href="classrlSocket.html">rlSocket</a> s(<span class="stringliteral">&quot;localhost&quot;</span>,port,0);
<a name="l00237"></a>00237   <span class="comment">// listener main loop</span>
<a name="l00238"></a>00238   <span class="keywordflow">while</span>(1){
<a name="l00239"></a>00239     socketdescr = s.connect();
<a name="l00240"></a>00240     <span class="keywordflow">if</span>(socketdescr == -1) <span class="keywordflow">break</span>;
<a name="l00241"></a>00241     tr.<a class="code" href="structTHREADTRANSFER.html#a030472e2b2f26d19e79a38a6597d4f60">socketdescr</a> = socketdescr;
<a name="l00242"></a>00242     daemonptr-&gt;<a class="code" href="classrlCanOpenDaemon.html#a0ba207ed336015b1ec56340aa1ffebce">daemon_thread</a>.<a class="code" href="classrlThread.html#a2e26bec1d1bc3bc35a3c8a1c9930f2fb">create</a>(<a class="code" href="rlcanopendaemon_8cpp.html#a78046224bc0729596e1af0c721acad79">clientconnection</a>, &amp;tr);
<a name="l00243"></a>00243     <span class="comment">// wait for clientconnection to save socketdescriptor</span>
<a name="l00244"></a>00244     <a class="code" href="rlwthread_8cpp.html#a604b0dba29427e3514cd37136458e0c5">rlsleep</a>(100); 
<a name="l00245"></a>00245   }
<a name="l00246"></a>00246   <a class="code" href="rlcutil_8cpp.html#a5380bd2e87ffcf0c8a24c387b0ac7b7b">rlDebugPrintf</a>(<span class="stringliteral">&quot;\n killing listener...\n&quot;</span>);
<a name="l00247"></a>00247   <span class="keywordflow">return</span> NULL;
<a name="l00248"></a>00248 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a75b08553e4d75c2dc274c9e0f293beab"></a><!-- doxytag: member="rlcanopendaemon.cpp::nmt_transmit" ref="a75b08553e4d75c2dc274c9e0f293beab" args="(rlCanOpenDaemon *_daemonptr, rlSocket *_socket, IPCMSGSTRUCT *_message)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void nmt_transmit </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classrlCanOpenDaemon.html">rlCanOpenDaemon</a> *&nbsp;</td>
          <td class="paramname"> <em>_daemonptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classrlSocket.html">rlSocket</a> *&nbsp;</td>
          <td class="paramname"> <em>_socket</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structIPCMSGSTRUCT.html">IPCMSGSTRUCT</a> *&nbsp;</td>
          <td class="paramname"> <em>_message</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>gets called from clientconnection thread. performs a nmt_transmit command on the canopen interface. received data is stored in an <a class="el" href="structIPCMSGSTRUCT.html" title="the IPCMSGSTRUCT is the transfer buffer which is send trough TCP sockets">IPCMSGSTRUCT</a> and sent back to the clientprocess </p>

<p>Definition at line <a class="el" href="rlcanopendaemon_8cpp_source.html#l00118">118</a> of file <a class="el" href="rlcanopendaemon_8cpp_source.html">rlcanopendaemon.cpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00120"></a>00120                                          {
<a name="l00121"></a>00121   <span class="keywordtype">char</span> returnvalue;
<a name="l00122"></a>00122   _daemonptr-&gt;<a class="code" href="classrlCanOpenDaemon.html#a0ba207ed336015b1ec56340aa1ffebce">daemon_thread</a>.<a class="code" href="classrlThread.html#a543d60a27fdd4362af6a859049e19f52">lock</a>();
<a name="l00123"></a>00123     returnvalue=_daemonptr-&gt;<a class="code" href="classrlCanOpenDaemon.html#ad32a3078d59a83504a752ced7bf9642c">nodes</a>-&gt;<a class="code" href="classrlCanOpen.html#a3b59ba388442d8ccf33f0f031752f6cd" title="send a NMT Command to one or all nodes (of one board)">sendNMTCommand</a>(_message-&gt;<a class="code" href="structIPCMSGSTRUCT.html#a3e9d17de9492c78203c3ca6881faf6ab">boardid</a>, 
<a name="l00124"></a>00124                                                   _message-&gt;<a class="code" href="structIPCMSGSTRUCT.html#a2acd50bbd96927117ea43f82e1fa8705">nodeid</a>, 
<a name="l00125"></a>00125                                                   _message-&gt;<a class="code" href="structIPCMSGSTRUCT.html#a85d3f9a8ebeece22a414750acb5906d6">mtext</a>[0]);
<a name="l00126"></a>00126   _daemonptr-&gt;<a class="code" href="classrlCanOpenDaemon.html#a0ba207ed336015b1ec56340aa1ffebce">daemon_thread</a>.<a class="code" href="classrlThread.html#ab52388712ba58b879ea1f0ceca547ad3">unlock</a>();
<a name="l00127"></a>00127   _message-&gt;<a class="code" href="structIPCMSGSTRUCT.html#a4c97b4f1dbf03de0358f3bc45ba527a0">msgtype</a>=<a class="code" href="rlcanopendaemon_8h.html#a84e97603720411166b6a7abf45a409f1afedc0e794922c328a0156660e781f7c0">MSG_PDO_TRANSMIT</a>; _message-&gt;<a class="code" href="structIPCMSGSTRUCT.html#aeabf16c705c41f39549f37b1341fcd40">transfertype</a>=returnvalue;
<a name="l00128"></a>00128   _socket-&gt;<a class="code" href="classrlSocket.html#aa069e328b2509cbbc15bf9c91684b6be">write</a>((<span class="keywordtype">void</span>*) _message, <span class="keyword">sizeof</span>(*_message));   
<a name="l00129"></a>00129 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af71b281a73ea060f938e95273f4ddaa1"></a><!-- doxytag: member="rlcanopendaemon.cpp::pdo_receive" ref="af71b281a73ea060f938e95273f4ddaa1" args="(rlCanOpenDaemon *_daemonptr, rlSocket *_socket, IPCMSGSTRUCT *_message)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void pdo_receive </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classrlCanOpenDaemon.html">rlCanOpenDaemon</a> *&nbsp;</td>
          <td class="paramname"> <em>_daemonptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classrlSocket.html">rlSocket</a> *&nbsp;</td>
          <td class="paramname"> <em>_socket</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structIPCMSGSTRUCT.html">IPCMSGSTRUCT</a> *&nbsp;</td>
          <td class="paramname"> <em>_message</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>gets called from clientconnection thread. performs a pdo_receive command on the canopen interface. received data is stored in an <a class="el" href="structIPCMSGSTRUCT.html" title="the IPCMSGSTRUCT is the transfer buffer which is send trough TCP sockets">IPCMSGSTRUCT</a> and sent back to the clientprocess </p>

<p>Definition at line <a class="el" href="rlcanopendaemon_8cpp_source.html#l00058">58</a> of file <a class="el" href="rlcanopendaemon_8cpp_source.html">rlcanopendaemon.cpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00060"></a>00060                                         {
<a name="l00061"></a>00061   <span class="keywordtype">int</span> returnvalue;
<a name="l00062"></a>00062   <a class="code" href="classrlCanOpenTypes.html" title="class to handle CANopen types">rlCanOpenTypes</a> cifmsg;
<a name="l00063"></a>00063   cifmsg.<a class="code" href="classrlCanOpenTypes.html#a9f3e044c60558bd0de010434241c9824" title="overwrites all data with IPCMSGSTRUCT data">getIpcMsg</a>(*_message);
<a name="l00064"></a>00064   _daemonptr-&gt;<a class="code" href="classrlCanOpenDaemon.html#a0ba207ed336015b1ec56340aa1ffebce">daemon_thread</a>.<a class="code" href="classrlThread.html#a543d60a27fdd4362af6a859049e19f52">lock</a>();
<a name="l00065"></a>00065     <span class="keywordflow">if</span> (_message-&gt;<a class="code" href="structIPCMSGSTRUCT.html#aed25748dde8a23b3527427ecf7d3f2e2">mappingid</a>==-1){
<a name="l00066"></a>00066       returnvalue=_daemonptr-&gt;<a class="code" href="classrlCanOpenDaemon.html#ad32a3078d59a83504a752ced7bf9642c">nodes</a>-&gt;<a class="code" href="classrlCanOpen.html#a73a3479ae9754495e17aa6591dbf135e" title="using the pdo_receive function you can receive a mapped object within PDO">pdo_receive</a>(_message-&gt;<a class="code" href="structIPCMSGSTRUCT.html#a3e9d17de9492c78203c3ca6881faf6ab">boardid</a>, 
<a name="l00067"></a>00067                                                 _message-&gt;<a class="code" href="structIPCMSGSTRUCT.html#a2acd50bbd96927117ea43f82e1fa8705">nodeid</a>, 
<a name="l00068"></a>00068                                                 _message-&gt;<a class="code" href="structIPCMSGSTRUCT.html#af538071d5478f764a4782d39481ad5c6">pdoid</a>, 
<a name="l00069"></a>00069                                                 cifmsg);
<a name="l00070"></a>00070     }
<a name="l00071"></a>00071     <span class="keywordflow">else</span>
<a name="l00072"></a>00072     {
<a name="l00073"></a>00073       returnvalue=_daemonptr-&gt;<a class="code" href="classrlCanOpenDaemon.html#ad32a3078d59a83504a752ced7bf9642c">nodes</a>-&gt;<a class="code" href="classrlCanOpen.html#a73a3479ae9754495e17aa6591dbf135e" title="using the pdo_receive function you can receive a mapped object within PDO">pdo_receive</a>(_message-&gt;<a class="code" href="structIPCMSGSTRUCT.html#a3e9d17de9492c78203c3ca6881faf6ab">boardid</a>, 
<a name="l00074"></a>00074                                                 _message-&gt;<a class="code" href="structIPCMSGSTRUCT.html#a2acd50bbd96927117ea43f82e1fa8705">nodeid</a>, 
<a name="l00075"></a>00075                                                 _message-&gt;<a class="code" href="structIPCMSGSTRUCT.html#af538071d5478f764a4782d39481ad5c6">pdoid</a>, 
<a name="l00076"></a>00076                                                 _message-&gt;<a class="code" href="structIPCMSGSTRUCT.html#aed25748dde8a23b3527427ecf7d3f2e2">mappingid</a>, 
<a name="l00077"></a>00077                                                 cifmsg);  
<a name="l00078"></a>00078     }
<a name="l00079"></a>00079   _daemonptr-&gt;<a class="code" href="classrlCanOpenDaemon.html#a0ba207ed336015b1ec56340aa1ffebce">daemon_thread</a>.<a class="code" href="classrlThread.html#ab52388712ba58b879ea1f0ceca547ad3">unlock</a>();
<a name="l00080"></a>00080   *_message = cifmsg.<a class="code" href="classrlCanOpenTypes.html#af59141fc2073831833333cd48214d878" title="returns a IPCMSGSTRUCT filled with current object data">createIpcMsg</a>();
<a name="l00081"></a>00081   _message-&gt;<a class="code" href="structIPCMSGSTRUCT.html#a4c97b4f1dbf03de0358f3bc45ba527a0">msgtype</a>=<a class="code" href="rlcanopendaemon_8h.html#a84e97603720411166b6a7abf45a409f1ae1f1be64e42d6e3a25c010e1dd335270">MSG_PDO_RECEIVE</a>; _message-&gt;<a class="code" href="structIPCMSGSTRUCT.html#aeabf16c705c41f39549f37b1341fcd40">transfertype</a>=returnvalue;
<a name="l00082"></a>00082   _socket-&gt;<a class="code" href="classrlSocket.html#aa069e328b2509cbbc15bf9c91684b6be">write</a>((<span class="keywordtype">void</span>*) _message, <span class="keyword">sizeof</span>(*_message));   
<a name="l00083"></a>00083 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3d493df597bef31c9bc2654f4bf7d686"></a><!-- doxytag: member="rlcanopendaemon.cpp::pdo_transmit" ref="a3d493df597bef31c9bc2654f4bf7d686" args="(rlCanOpenDaemon *_daemonptr, rlSocket *_socket, IPCMSGSTRUCT *_message)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void pdo_transmit </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classrlCanOpenDaemon.html">rlCanOpenDaemon</a> *&nbsp;</td>
          <td class="paramname"> <em>_daemonptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classrlSocket.html">rlSocket</a> *&nbsp;</td>
          <td class="paramname"> <em>_socket</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structIPCMSGSTRUCT.html">IPCMSGSTRUCT</a> *&nbsp;</td>
          <td class="paramname"> <em>_message</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>gets called from clientconnection thread. performs a pdo_transmit command on the canopen interface. received data is stored in an <a class="el" href="structIPCMSGSTRUCT.html" title="the IPCMSGSTRUCT is the transfer buffer which is send trough TCP sockets">IPCMSGSTRUCT</a> and sent back to the clientprocess </p>

<p>Definition at line <a class="el" href="rlcanopendaemon_8cpp_source.html#l00088">88</a> of file <a class="el" href="rlcanopendaemon_8cpp_source.html">rlcanopendaemon.cpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00090"></a>00090                                          {
<a name="l00091"></a>00091   <span class="keywordtype">int</span> returnvalue;
<a name="l00092"></a>00092   <a class="code" href="classrlCanOpenTypes.html" title="class to handle CANopen types">rlCanOpenTypes</a> cifmsg;
<a name="l00093"></a>00093   cifmsg.<a class="code" href="classrlCanOpenTypes.html#a9f3e044c60558bd0de010434241c9824" title="overwrites all data with IPCMSGSTRUCT data">getIpcMsg</a>(*_message);
<a name="l00094"></a>00094   _daemonptr-&gt;<a class="code" href="classrlCanOpenDaemon.html#a0ba207ed336015b1ec56340aa1ffebce">daemon_thread</a>.<a class="code" href="classrlThread.html#a543d60a27fdd4362af6a859049e19f52">lock</a>();
<a name="l00095"></a>00095     <span class="keywordflow">if</span> (_message-&gt;<a class="code" href="structIPCMSGSTRUCT.html#aed25748dde8a23b3527427ecf7d3f2e2">mappingid</a>==-1){
<a name="l00096"></a>00096       returnvalue=_daemonptr-&gt;<a class="code" href="classrlCanOpenDaemon.html#ad32a3078d59a83504a752ced7bf9642c">nodes</a>-&gt;<a class="code" href="classrlCanOpen.html#aa0af0f6576ec284128e9c3efb4770ca2" title="transmit a mapped object within a PDO to a specific node">pdo_transmit</a>(_message-&gt;<a class="code" href="structIPCMSGSTRUCT.html#a3e9d17de9492c78203c3ca6881faf6ab">boardid</a>, 
<a name="l00097"></a>00097                                                   _message-&gt;<a class="code" href="structIPCMSGSTRUCT.html#a2acd50bbd96927117ea43f82e1fa8705">nodeid</a>, 
<a name="l00098"></a>00098                                                   _message-&gt;<a class="code" href="structIPCMSGSTRUCT.html#af538071d5478f764a4782d39481ad5c6">pdoid</a>, 
<a name="l00099"></a>00099                                                   cifmsg);
<a name="l00100"></a>00100     }
<a name="l00101"></a>00101     <span class="keywordflow">else</span>
<a name="l00102"></a>00102     {
<a name="l00103"></a>00103       returnvalue=_daemonptr-&gt;<a class="code" href="classrlCanOpenDaemon.html#ad32a3078d59a83504a752ced7bf9642c">nodes</a>-&gt;<a class="code" href="classrlCanOpen.html#aa0af0f6576ec284128e9c3efb4770ca2" title="transmit a mapped object within a PDO to a specific node">pdo_transmit</a>(_message-&gt;<a class="code" href="structIPCMSGSTRUCT.html#a3e9d17de9492c78203c3ca6881faf6ab">boardid</a>, 
<a name="l00104"></a>00104                                                   _message-&gt;<a class="code" href="structIPCMSGSTRUCT.html#a2acd50bbd96927117ea43f82e1fa8705">nodeid</a>, 
<a name="l00105"></a>00105                                                   _message-&gt;<a class="code" href="structIPCMSGSTRUCT.html#af538071d5478f764a4782d39481ad5c6">pdoid</a>, 
<a name="l00106"></a>00106                                                   _message-&gt;<a class="code" href="structIPCMSGSTRUCT.html#aed25748dde8a23b3527427ecf7d3f2e2">mappingid</a>, 
<a name="l00107"></a>00107                                                   cifmsg);  
<a name="l00108"></a>00108     }
<a name="l00109"></a>00109   _daemonptr-&gt;<a class="code" href="classrlCanOpenDaemon.html#a0ba207ed336015b1ec56340aa1ffebce">daemon_thread</a>.<a class="code" href="classrlThread.html#ab52388712ba58b879ea1f0ceca547ad3">unlock</a>();
<a name="l00110"></a>00110   *_message = cifmsg.<a class="code" href="classrlCanOpenTypes.html#af59141fc2073831833333cd48214d878" title="returns a IPCMSGSTRUCT filled with current object data">createIpcMsg</a>();
<a name="l00111"></a>00111   _message-&gt;<a class="code" href="structIPCMSGSTRUCT.html#a4c97b4f1dbf03de0358f3bc45ba527a0">msgtype</a>=<a class="code" href="rlcanopendaemon_8h.html#a84e97603720411166b6a7abf45a409f1afedc0e794922c328a0156660e781f7c0">MSG_PDO_TRANSMIT</a>; _message-&gt;<a class="code" href="structIPCMSGSTRUCT.html#aeabf16c705c41f39549f37b1341fcd40">transfertype</a>=returnvalue;
<a name="l00112"></a>00112   _socket-&gt;<a class="code" href="classrlSocket.html#aa069e328b2509cbbc15bf9c91684b6be">write</a>((<span class="keywordtype">void</span>*) _message, <span class="keyword">sizeof</span>(*_message));   
<a name="l00113"></a>00113 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac49104ffe6f20c359102f1912dddc2fe"></a><!-- doxytag: member="rlcanopendaemon.cpp::restart_board" ref="ac49104ffe6f20c359102f1912dddc2fe" args="(rlCanOpenDaemon *_daemonptr, rlSocket *_socket, IPCMSGSTRUCT *_message)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void restart_board </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classrlCanOpenDaemon.html">rlCanOpenDaemon</a> *&nbsp;</td>
          <td class="paramname"> <em>_daemonptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classrlSocket.html">rlSocket</a> *&nbsp;</td>
          <td class="paramname"> <em>_socket</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structIPCMSGSTRUCT.html">IPCMSGSTRUCT</a> *&nbsp;</td>
          <td class="paramname"> <em>_message</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>gets called from clientconnection thread. performs a restartBoard command on the canopen interface. received data is stored in an <a class="el" href="structIPCMSGSTRUCT.html" title="the IPCMSGSTRUCT is the transfer buffer which is send trough TCP sockets">IPCMSGSTRUCT</a> and sent back to the clientprocess </p>

<p>Definition at line <a class="el" href="rlcanopendaemon_8cpp_source.html#l00134">134</a> of file <a class="el" href="rlcanopendaemon_8cpp_source.html">rlcanopendaemon.cpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00136"></a>00136                                           {
<a name="l00137"></a>00137   <span class="keywordtype">char</span> returnvalue;
<a name="l00138"></a>00138   _daemonptr-&gt;<a class="code" href="classrlCanOpenDaemon.html#a0ba207ed336015b1ec56340aa1ffebce">daemon_thread</a>.<a class="code" href="classrlThread.html#a543d60a27fdd4362af6a859049e19f52">lock</a>();
<a name="l00139"></a>00139     returnvalue=_daemonptr-&gt;<a class="code" href="classrlCanOpenDaemon.html#ad32a3078d59a83504a752ced7bf9642c">nodes</a>-&gt;<a class="code" href="classrlCanOpen.html#ac65b49a7d5677c354cd73c6980687219" title="using this function you are able to restart a CanOpenMaster board">restartBoard</a>(_message-&gt;<a class="code" href="structIPCMSGSTRUCT.html#a3e9d17de9492c78203c3ca6881faf6ab">boardid</a>, 
<a name="l00140"></a>00140                                                 (<span class="keywordtype">int</span>) _message-&gt;<a class="code" href="structIPCMSGSTRUCT.html#a85d3f9a8ebeece22a414750acb5906d6">mtext</a>[0]);
<a name="l00141"></a>00141   _daemonptr-&gt;<a class="code" href="classrlCanOpenDaemon.html#a0ba207ed336015b1ec56340aa1ffebce">daemon_thread</a>.<a class="code" href="classrlThread.html#ab52388712ba58b879ea1f0ceca547ad3">unlock</a>();
<a name="l00142"></a>00142   _message-&gt;<a class="code" href="structIPCMSGSTRUCT.html#a4c97b4f1dbf03de0358f3bc45ba527a0">msgtype</a>=<a class="code" href="rlcanopendaemon_8h.html#a84e97603720411166b6a7abf45a409f1afedc0e794922c328a0156660e781f7c0">MSG_PDO_TRANSMIT</a>; _message-&gt;<a class="code" href="structIPCMSGSTRUCT.html#aeabf16c705c41f39549f37b1341fcd40">transfertype</a>=returnvalue;
<a name="l00143"></a>00143   _socket-&gt;<a class="code" href="classrlSocket.html#aa069e328b2509cbbc15bf9c91684b6be">write</a>((<span class="keywordtype">void</span>*) _message, <span class="keyword">sizeof</span>(*_message));   
<a name="l00144"></a>00144 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a51ba1765537b52ff4795f6ef0424c690"></a><!-- doxytag: member="rlcanopendaemon.cpp::sdo_read" ref="a51ba1765537b52ff4795f6ef0424c690" args="(rlCanOpenDaemon *_daemonptr, rlSocket *_socket, IPCMSGSTRUCT *_message)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sdo_read </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classrlCanOpenDaemon.html">rlCanOpenDaemon</a> *&nbsp;</td>
          <td class="paramname"> <em>_daemonptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classrlSocket.html">rlSocket</a> *&nbsp;</td>
          <td class="paramname"> <em>_socket</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structIPCMSGSTRUCT.html">IPCMSGSTRUCT</a> *&nbsp;</td>
          <td class="paramname"> <em>_message</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>gets called from clientconnection thread. performs a sdo_read command on the canopen interface. received data is stored in an <a class="el" href="structIPCMSGSTRUCT.html" title="the IPCMSGSTRUCT is the transfer buffer which is send trough TCP sockets">IPCMSGSTRUCT</a> and sent back to the clientprocess </p>

<p>Definition at line <a class="el" href="rlcanopendaemon_8cpp_source.html#l00021">21</a> of file <a class="el" href="rlcanopendaemon_8cpp_source.html">rlcanopendaemon.cpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00023"></a>00023                                      {
<a name="l00024"></a>00024   <a class="code" href="classrlCanOpenTypes.html" title="class to handle CANopen types">rlCanOpenTypes</a> cifmsg;
<a name="l00025"></a>00025   _daemonptr-&gt;<a class="code" href="classrlCanOpenDaemon.html#a0ba207ed336015b1ec56340aa1ffebce">daemon_thread</a>.<a class="code" href="classrlThread.html#a543d60a27fdd4362af6a859049e19f52">lock</a>();
<a name="l00026"></a>00026     _daemonptr-&gt;<a class="code" href="classrlCanOpenDaemon.html#ad32a3078d59a83504a752ced7bf9642c">nodes</a>-&gt;<a class="code" href="classrlCanOpen.html#a0a0e5e4328ff82cc5a7de3e8fa9c9713" title="read a certain object from the object dictionary of a node">sdo_read</a>(_message-&gt;<a class="code" href="structIPCMSGSTRUCT.html#a3e9d17de9492c78203c3ca6881faf6ab">boardid</a>, 
<a name="l00027"></a>00027                                 _message-&gt;<a class="code" href="structIPCMSGSTRUCT.html#a2acd50bbd96927117ea43f82e1fa8705">nodeid</a>, 
<a name="l00028"></a>00028                                 _message-&gt;<a class="code" href="structIPCMSGSTRUCT.html#a1205d3341828bba91a988a38c6f98790">objectindex</a>, 
<a name="l00029"></a>00029                                 _message-&gt;<a class="code" href="structIPCMSGSTRUCT.html#a84008b9e507ab525216cf0b0af900eed">subindex</a>, cifmsg);
<a name="l00030"></a>00030   _daemonptr-&gt;<a class="code" href="classrlCanOpenDaemon.html#a0ba207ed336015b1ec56340aa1ffebce">daemon_thread</a>.<a class="code" href="classrlThread.html#ab52388712ba58b879ea1f0ceca547ad3">unlock</a>();
<a name="l00031"></a>00031   *_message = cifmsg.<a class="code" href="classrlCanOpenTypes.html#af59141fc2073831833333cd48214d878" title="returns a IPCMSGSTRUCT filled with current object data">createIpcMsg</a>();
<a name="l00032"></a>00032   _message-&gt;<a class="code" href="structIPCMSGSTRUCT.html#a4c97b4f1dbf03de0358f3bc45ba527a0">msgtype</a>=<a class="code" href="rlcanopendaemon_8h.html#a84e97603720411166b6a7abf45a409f1a08c61a4cef5241dfb8d394e2c4889613">MSG_SDO_READ</a>; _message-&gt;<a class="code" href="structIPCMSGSTRUCT.html#aeabf16c705c41f39549f37b1341fcd40">transfertype</a>=<a class="code" href="rlcanopendaemon_8h.html#a84e97603720411166b6a7abf45a409f1a9a8b8c70e5e50e70a1dd8edfacea4da2">MSG_RECEIVE</a>;
<a name="l00033"></a>00033   _socket-&gt;<a class="code" href="classrlSocket.html#aa069e328b2509cbbc15bf9c91684b6be">write</a>((<span class="keywordtype">void</span>*) _message, <span class="keyword">sizeof</span>(*_message));
<a name="l00034"></a>00034 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="addf026270ccb455ee80506d5126ca7a9"></a><!-- doxytag: member="rlcanopendaemon.cpp::sdo_write" ref="addf026270ccb455ee80506d5126ca7a9" args="(rlCanOpenDaemon *_daemonptr, rlSocket *_socket, IPCMSGSTRUCT *_message)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sdo_write </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classrlCanOpenDaemon.html">rlCanOpenDaemon</a> *&nbsp;</td>
          <td class="paramname"> <em>_daemonptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classrlSocket.html">rlSocket</a> *&nbsp;</td>
          <td class="paramname"> <em>_socket</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structIPCMSGSTRUCT.html">IPCMSGSTRUCT</a> *&nbsp;</td>
          <td class="paramname"> <em>_message</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>gets called from clientconnection thread. performs a sdo_write command on the canopen interface. received data is stored in an <a class="el" href="structIPCMSGSTRUCT.html" title="the IPCMSGSTRUCT is the transfer buffer which is send trough TCP sockets">IPCMSGSTRUCT</a> and sent back to the clientprocess </p>

<p>Definition at line <a class="el" href="rlcanopendaemon_8cpp_source.html#l00039">39</a> of file <a class="el" href="rlcanopendaemon_8cpp_source.html">rlcanopendaemon.cpp</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00041"></a>00041                                       {
<a name="l00042"></a>00042   <a class="code" href="classrlCanOpenTypes.html" title="class to handle CANopen types">rlCanOpenTypes</a> cifmsg;
<a name="l00043"></a>00043   cifmsg.<a class="code" href="classrlCanOpenTypes.html#a9f3e044c60558bd0de010434241c9824" title="overwrites all data with IPCMSGSTRUCT data">getIpcMsg</a>(*_message);
<a name="l00044"></a>00044   _daemonptr-&gt;<a class="code" href="classrlCanOpenDaemon.html#a0ba207ed336015b1ec56340aa1ffebce">daemon_thread</a>.<a class="code" href="classrlThread.html#a543d60a27fdd4362af6a859049e19f52">lock</a>();
<a name="l00045"></a>00045     _daemonptr-&gt;<a class="code" href="classrlCanOpenDaemon.html#ad32a3078d59a83504a752ced7bf9642c">nodes</a>-&gt;<a class="code" href="classrlCanOpen.html#afe214122e51cdd214d586ef1b50a5b34" title="write data into a certain object from the object dictionary of a node">sdo_write</a>(_message-&gt;<a class="code" href="structIPCMSGSTRUCT.html#a3e9d17de9492c78203c3ca6881faf6ab">boardid</a>, 
<a name="l00046"></a>00046                                  _message-&gt;<a class="code" href="structIPCMSGSTRUCT.html#a2acd50bbd96927117ea43f82e1fa8705">nodeid</a>, 
<a name="l00047"></a>00047                                  _message-&gt;<a class="code" href="structIPCMSGSTRUCT.html#a1205d3341828bba91a988a38c6f98790">objectindex</a>, 
<a name="l00048"></a>00048                                  _message-&gt;<a class="code" href="structIPCMSGSTRUCT.html#a84008b9e507ab525216cf0b0af900eed">subindex</a>, cifmsg);
<a name="l00049"></a>00049   _daemonptr-&gt;<a class="code" href="classrlCanOpenDaemon.html#a0ba207ed336015b1ec56340aa1ffebce">daemon_thread</a>.<a class="code" href="classrlThread.html#ab52388712ba58b879ea1f0ceca547ad3">unlock</a>();
<a name="l00050"></a>00050   *_message = cifmsg.<a class="code" href="classrlCanOpenTypes.html#af59141fc2073831833333cd48214d878" title="returns a IPCMSGSTRUCT filled with current object data">createIpcMsg</a>();
<a name="l00051"></a>00051   _message-&gt;<a class="code" href="structIPCMSGSTRUCT.html#a4c97b4f1dbf03de0358f3bc45ba527a0">msgtype</a>=<a class="code" href="rlcanopendaemon_8h.html#a84e97603720411166b6a7abf45a409f1a39ace9ec46bece3742400a7c02854730">MSG_SDO_WRITE</a>; _message-&gt;<a class="code" href="structIPCMSGSTRUCT.html#aeabf16c705c41f39549f37b1341fcd40">transfertype</a>=<a class="code" href="rlcanopendaemon_8h.html#a84e97603720411166b6a7abf45a409f1a9a8b8c70e5e50e70a1dd8edfacea4da2">MSG_RECEIVE</a>;
<a name="l00052"></a>00052   _socket-&gt;<a class="code" href="classrlSocket.html#aa069e328b2509cbbc15bf9c91684b6be">write</a>((<span class="keywordtype">void</span>*) _message, <span class="keyword">sizeof</span>(*_message));   
<a name="l00053"></a>00053 }
</pre></div></p>

</div>
</div>
</div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Sun Aug 1 12:16:11 2010 for rllib by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
