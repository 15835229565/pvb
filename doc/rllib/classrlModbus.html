<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>rllib: rlModbus Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">rllib
   &#160;<span id="projectnumber">1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-types">Public Types</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-attribs">Public Attributes</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a>  </div>
  <div class="headertitle">
<div class="title">rlModbus Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="rlmodbus_8h_source.html">rlmodbus.h</a>&gt;</code></p>
<div class="dynheader">
Collaboration diagram for rlModbus:</div>
<div class="dyncontent">
<div class="center"><img src="classrlModbus__coll__graph.png" border="0" usemap="#rlModbus_coll__map" alt="Collaboration graph"/></div>
<map name="rlModbus_coll__map" id="rlModbus_coll__map">
<area shape="rect" id="node2" href="classrlSerial.html" title="rlSerial" alt="" coords="5,5,67,32"/><area shape="rect" id="node4" href="classrlSocket.html" title="rlSocket" alt="" coords="91,5,161,32"/></map>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>

<p><a href="classrlModbus-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="pub-types"></a>
Public Types</h2></td></tr>
<tr class="memitem:a359c129c50db845b9f57181ea1132989"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989">Modbus</a> { <br/>
&#160;&#160;<a class="el" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989a7e0314efdf6912fcc42895797b03f6fa">MODBUS_CHECKSUM_ERROR</a> =  -2, 
<a class="el" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a> =  -1, 
<a class="el" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ae5c1eaaf0071d082751fcdcfa624e52f">MODBUS_SUCCESS</a> =  0, 
<a class="el" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989abd970eee924a7c780af05ab79bf94231">MODBUS_RTU</a> =  1, 
<br/>
&#160;&#160;<a class="el" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab29d44112460cd074cbaa194b98c8a90">MODBUS_ASCII</a> =  2
<br/>
 }</td></tr>
<tr class="memitem:af220cecff330a69323f040b1c239c657"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classrlModbus.html#af220cecff330a69323f040b1c239c657">ModbusFunctionCodes</a> { <br/>
&#160;&#160;<a class="el" href="classrlModbus.html#af220cecff330a69323f040b1c239c657ad104f9632c5253ab7a9da0bbfe123e88">ReadCoilStatus</a> =  1, 
<a class="el" href="classrlModbus.html#af220cecff330a69323f040b1c239c657af76896036e7b31809af71efc96e02c68">ReadInputStatus</a> =  2, 
<a class="el" href="classrlModbus.html#af220cecff330a69323f040b1c239c657afbc16bd1a560babc7abcecd6c17a792d">ReadHoldingRegisters</a> =  3, 
<a class="el" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a4264060e1f2bed5ce560206edad22d6c">ReadInputRegisters</a> =  4, 
<br/>
&#160;&#160;<a class="el" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a885ab1a9d24d8e05107d3558ebd3e3fe">ForceSingleCoil</a> =  5, 
<a class="el" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a4af03846c50ff298649fefee8087e8ed">PresetSingleRegister</a> =  6, 
<a class="el" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a9b5d2f1cde4cb8de72946073a21a9806">ReadExceptionStatus</a> =  7, 
<a class="el" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a1466463ec93749a854bfb0ce85e2acc7">FetchCommEventCtr</a> =  11, 
<br/>
&#160;&#160;<a class="el" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a0777ef09e8622d6ce0113f11c8c3929e">FetchCommEventLog</a> =  12, 
<a class="el" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a21384c6826ad985c85bbda6e22d93043">ForceMultipleCoils</a> =  15, 
<a class="el" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a485fed5b1927d6bf0db7311e76136fb0">PresetMultipleRegs</a> =  16, 
<a class="el" href="classrlModbus.html#af220cecff330a69323f040b1c239c657ae33cbee198a6bfcc56eef4485b365016">ReportSlaveID</a> =  17, 
<br/>
&#160;&#160;<a class="el" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a3c07ffeaae29454fc00ab73774be136e">ReadGeneralReference</a> =  20, 
<a class="el" href="classrlModbus.html#af220cecff330a69323f040b1c239c657ad98842ba604a74afa38555c260bb284a">WriteGeneralReference</a> =  21, 
<a class="el" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a35c8bfdb88eecf8e49d0fadfc7eaa237">MaskWrite4XRegisters</a> =  22, 
<a class="el" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a9b7a98765b8b1695533cab836f7cd7b6">ReadWrite4XRegisters</a> =  23, 
<br/>
&#160;&#160;<a class="el" href="classrlModbus.html#af220cecff330a69323f040b1c239c657afa0a0876504de7552e05ce9516cba94d">ReadFifoQueue</a> =  24
<br/>
 }</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a43ef0acf82595fafd7ef452cdd6710b8"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classrlModbus.html#a43ef0acf82595fafd7ef452cdd6710b8">rlModbus</a> (long max_telegram_length=1024, int <a class="el" href="classrlModbus.html#aa6a054b45000251c837abd658ef03339">mode</a>=<a class="el" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989abd970eee924a7c780af05ab79bf94231">MODBUS_RTU</a>, char end_delimitor=0x0a)</td></tr>
<tr class="memitem:a4ac68440a43fa4eae5ec87bd0b9ed20c"><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classrlModbus.html#a4ac68440a43fa4eae5ec87bd0b9ed20c">~rlModbus</a> ()</td></tr>
<tr class="memitem:a7efc504fc4759fc04add6b33d64bf28c"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classrlModbus.html#a7efc504fc4759fc04add6b33d64bf28c">write</a> (int slave, int function, const unsigned char *data, int len, int *transactionID=NULL)</td></tr>
<tr class="memitem:af372c588b1805e831a7f3a6fc7760b58"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classrlModbus.html#af372c588b1805e831a7f3a6fc7760b58">request</a> (int slave, int function, int start_adr, int num_register)</td></tr>
<tr class="memitem:ad4b7dd434f85952ed1cc7ade9a606fa1"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classrlModbus.html#ad4b7dd434f85952ed1cc7ade9a606fa1">response</a> (int *slave, int *function, unsigned char *data, int timeout=1000)</td></tr>
<tr class="memitem:af128e63b30e6ed165fb3667893c94418"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classrlModbus.html#af128e63b30e6ed165fb3667893c94418">readRequest</a> (int *slave, int *function, unsigned char *data, int timeout=1000, int *transactionID=NULL)</td></tr>
<tr class="memitem:a5ce8a4c1476a6bbc5196422cc01f044a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classrlModbus.html#a5ce8a4c1476a6bbc5196422cc01f044a">registerSocket</a> (<a class="el" href="classrlSocket.html">rlSocket</a> *socket)</td></tr>
<tr class="memitem:a1617b6cea5012eafc150ab11ae7ccf87"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classrlModbus.html#a1617b6cea5012eafc150ab11ae7ccf87">registerSerial</a> (<a class="el" href="classrlSerial.html">rlSerial</a> *serial)</td></tr>
<tr class="memitem:a02da348cb1bef2021a253189f55aeb11"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classrlModbus.html#a02da348cb1bef2021a253189f55aeb11">data2int</a> (const unsigned char *data)</td></tr>
<tr class="memitem:a3d80c0194c6836bc9419395da0daabdc"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classrlModbus.html#a3d80c0194c6836bc9419395da0daabdc">int2data</a> (int val, unsigned char *data)</td></tr>
<tr class="memitem:a6251a9bdb6cf258219bd324c7c8e0bb5"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classrlModbus.html#a6251a9bdb6cf258219bd324c7c8e0bb5">intsize</a> ()</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr class="memitem:a5d323c81b0dac5fd991fd28e9fb3ac80"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classrlModbus.html#a5d323c81b0dac5fd991fd28e9fb3ac80">autoreconnectSocket</a></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:a4ce50e07415541dc3ce44ef6d5eb20fc"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classrlModbus.html#a4ce50e07415541dc3ce44ef6d5eb20fc">buf2int_rtu</a> (unsigned char *buf)</td></tr>
<tr class="memitem:ab8548df29f72a5400bfca2a2576e171e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classrlModbus.html#ab8548df29f72a5400bfca2a2576e171e">int2buf_rtu</a> (int i, unsigned char *buf)</td></tr>
<tr class="memitem:a7f0fa2807658c4fd4b7fe0a582f8c386"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classrlModbus.html#a7f0fa2807658c4fd4b7fe0a582f8c386">buf2int_ascii</a> (unsigned char *buf)</td></tr>
<tr class="memitem:ac8a9fb10a9d7940eea47945a62929af6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classrlModbus.html#ac8a9fb10a9d7940eea47945a62929af6">int2buf_ascii</a> (int i, unsigned char *buf)</td></tr>
<tr class="memitem:a7fcc08ea7c9efff7529d5e9ceb5722b2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classrlModbus.html#a7fcc08ea7c9efff7529d5e9ceb5722b2">insertLRC</a> (int len)</td></tr>
<tr class="memitem:af22f8da932f8c51dc584596f2e7e4d47"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classrlModbus.html#af22f8da932f8c51dc584596f2e7e4d47">insertCRC</a> (int len)</td></tr>
<tr class="memitem:ad9c8ac435545e9f724bd905c1db49f28"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classrlModbus.html#ad9c8ac435545e9f724bd905c1db49f28">LRCerror</a> (int len)</td></tr>
<tr class="memitem:af960ac56c12c00e7dd2ce0a3c3fbfb1e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classrlModbus.html#af960ac56c12c00e7dd2ce0a3c3fbfb1e">CRCerror</a> (int len)</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:add9b1e7cbb325c771bdfe1ebf780d3b5"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classrlSocket.html">rlSocket</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classrlModbus.html#add9b1e7cbb325c771bdfe1ebf780d3b5">s</a></td></tr>
<tr class="memitem:ada836e7daccef09a72c3bf782451e160"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classrlSerial.html">rlSerial</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classrlModbus.html#ada836e7daccef09a72c3bf782451e160">tty</a></td></tr>
<tr class="memitem:a8b8d2c8ccd15c70b3313b914b9252c09"><td class="memItemLeft" align="right" valign="top">unsigned char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classrlModbus.html#a8b8d2c8ccd15c70b3313b914b9252c09">tel</a></td></tr>
<tr class="memitem:a0404de78dcd9182a39be0f7ffe23b19c"><td class="memItemLeft" align="right" valign="top">long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classrlModbus.html#a0404de78dcd9182a39be0f7ffe23b19c">maxtel</a></td></tr>
<tr class="memitem:aa6a054b45000251c837abd658ef03339"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classrlModbus.html#aa6a054b45000251c837abd658ef03339">mode</a></td></tr>
<tr class="memitem:a9777d76fbc901e32d03bbc86ca557842"><td class="memItemLeft" align="right" valign="top">char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classrlModbus.html#a9777d76fbc901e32d03bbc86ca557842">delimitor</a></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><pre>
This class implements the modbus protocol.
You can use serial interfaces or TCP/IP.
Modbus RTU and ASCII are available.
</pre> 
<p>Definition at line <a class="el" href="rlmodbus_8h_source.html#l00028">28</a> of file <a class="el" href="rlmodbus_8h_source.html">rlmodbus.h</a>.</p>
</div><hr/><h2>Member Enumeration Documentation</h2>
<a class="anchor" id="a359c129c50db845b9f57181ea1132989"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989">rlModbus::Modbus</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="a359c129c50db845b9f57181ea1132989a7e0314efdf6912fcc42895797b03f6fa"></a>MODBUS_CHECKSUM_ERROR</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a"></a>MODBUS_ERROR</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a359c129c50db845b9f57181ea1132989ae5c1eaaf0071d082751fcdcfa624e52f"></a>MODBUS_SUCCESS</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a359c129c50db845b9f57181ea1132989abd970eee924a7c780af05ab79bf94231"></a>MODBUS_RTU</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a359c129c50db845b9f57181ea1132989ab29d44112460cd074cbaa194b98c8a90"></a>MODBUS_ASCII</em>&nbsp;</td><td>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="rlmodbus_8h_source.html#l00031">31</a> of file <a class="el" href="rlmodbus_8h_source.html">rlmodbus.h</a>.</p>
<div class="fragment"><div class="line">    {</div>
<div class="line">      <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989a7e0314efdf6912fcc42895797b03f6fa">MODBUS_CHECKSUM_ERROR</a> = -2,</div>
<div class="line">      <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>          = -1,</div>
<div class="line">      <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ae5c1eaaf0071d082751fcdcfa624e52f">MODBUS_SUCCESS</a>        = 0,</div>
<div class="line">      <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989abd970eee924a7c780af05ab79bf94231">MODBUS_RTU</a>            = 1,</div>
<div class="line">      <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab29d44112460cd074cbaa194b98c8a90">MODBUS_ASCII</a>          = 2</div>
<div class="line">    };</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af220cecff330a69323f040b1c239c657"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="classrlModbus.html#af220cecff330a69323f040b1c239c657">rlModbus::ModbusFunctionCodes</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="af220cecff330a69323f040b1c239c657ad104f9632c5253ab7a9da0bbfe123e88"></a>ReadCoilStatus</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af220cecff330a69323f040b1c239c657af76896036e7b31809af71efc96e02c68"></a>ReadInputStatus</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af220cecff330a69323f040b1c239c657afbc16bd1a560babc7abcecd6c17a792d"></a>ReadHoldingRegisters</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af220cecff330a69323f040b1c239c657a4264060e1f2bed5ce560206edad22d6c"></a>ReadInputRegisters</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af220cecff330a69323f040b1c239c657a885ab1a9d24d8e05107d3558ebd3e3fe"></a>ForceSingleCoil</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af220cecff330a69323f040b1c239c657a4af03846c50ff298649fefee8087e8ed"></a>PresetSingleRegister</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af220cecff330a69323f040b1c239c657a9b5d2f1cde4cb8de72946073a21a9806"></a>ReadExceptionStatus</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af220cecff330a69323f040b1c239c657a1466463ec93749a854bfb0ce85e2acc7"></a>FetchCommEventCtr</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af220cecff330a69323f040b1c239c657a0777ef09e8622d6ce0113f11c8c3929e"></a>FetchCommEventLog</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af220cecff330a69323f040b1c239c657a21384c6826ad985c85bbda6e22d93043"></a>ForceMultipleCoils</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af220cecff330a69323f040b1c239c657a485fed5b1927d6bf0db7311e76136fb0"></a>PresetMultipleRegs</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af220cecff330a69323f040b1c239c657ae33cbee198a6bfcc56eef4485b365016"></a>ReportSlaveID</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af220cecff330a69323f040b1c239c657a3c07ffeaae29454fc00ab73774be136e"></a>ReadGeneralReference</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af220cecff330a69323f040b1c239c657ad98842ba604a74afa38555c260bb284a"></a>WriteGeneralReference</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af220cecff330a69323f040b1c239c657a35c8bfdb88eecf8e49d0fadfc7eaa237"></a>MaskWrite4XRegisters</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af220cecff330a69323f040b1c239c657a9b7a98765b8b1695533cab836f7cd7b6"></a>ReadWrite4XRegisters</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af220cecff330a69323f040b1c239c657afa0a0876504de7552e05ce9516cba94d"></a>ReadFifoQueue</em>&nbsp;</td><td>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="rlmodbus_8h_source.html#l00040">40</a> of file <a class="el" href="rlmodbus_8h_source.html">rlmodbus.h</a>.</p>
<div class="fragment"><div class="line">    {</div>
<div class="line">      <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657ad104f9632c5253ab7a9da0bbfe123e88">ReadCoilStatus</a>         = 1,</div>
<div class="line">      <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657af76896036e7b31809af71efc96e02c68">ReadInputStatus</a>        = 2,</div>
<div class="line">      <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657afbc16bd1a560babc7abcecd6c17a792d">ReadHoldingRegisters</a>   = 3,</div>
<div class="line">      <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a4264060e1f2bed5ce560206edad22d6c">ReadInputRegisters</a>     = 4,</div>
<div class="line">      <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a885ab1a9d24d8e05107d3558ebd3e3fe">ForceSingleCoil</a>        = 5,</div>
<div class="line">      <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a4af03846c50ff298649fefee8087e8ed">PresetSingleRegister</a>   = 6,</div>
<div class="line">      <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a9b5d2f1cde4cb8de72946073a21a9806">ReadExceptionStatus</a>    = 7,</div>
<div class="line">      <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a1466463ec93749a854bfb0ce85e2acc7">FetchCommEventCtr</a>      = 11,</div>
<div class="line">      <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a0777ef09e8622d6ce0113f11c8c3929e">FetchCommEventLog</a>      = 12,</div>
<div class="line">      <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a21384c6826ad985c85bbda6e22d93043">ForceMultipleCoils</a>     = 15,</div>
<div class="line">      <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a485fed5b1927d6bf0db7311e76136fb0">PresetMultipleRegs</a>     = 16,</div>
<div class="line">      <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657ae33cbee198a6bfcc56eef4485b365016">ReportSlaveID</a>          = 17,</div>
<div class="line">      <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a3c07ffeaae29454fc00ab73774be136e">ReadGeneralReference</a>   = 20,</div>
<div class="line">      <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657ad98842ba604a74afa38555c260bb284a">WriteGeneralReference</a>  = 21,</div>
<div class="line">      <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a35c8bfdb88eecf8e49d0fadfc7eaa237">MaskWrite4XRegisters</a>   = 22,</div>
<div class="line">      <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a9b7a98765b8b1695533cab836f7cd7b6">ReadWrite4XRegisters</a>   = 23,</div>
<div class="line">      <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657afa0a0876504de7552e05ce9516cba94d">ReadFifoQueue</a>          = 24</div>
<div class="line">    };</div>
</div><!-- fragment -->
</div>
</div>
<hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a43ef0acf82595fafd7ef452cdd6710b8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">rlModbus::rlModbus </td>
          <td>(</td>
          <td class="paramtype">long&#160;</td>
          <td class="paramname"><em>max_telegram_length</em> = <code>1024</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>mode</em> = <code><a class="el" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989abd970eee924a7c780af05ab79bf94231">MODBUS_RTU</a></code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&#160;</td>
          <td class="paramname"><em>end_delimitor</em> = <code>0x0a</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="rlmodbus_8cpp_source.html#l00020">20</a> of file <a class="el" href="rlmodbus_8cpp_source.html">rlmodbus.cpp</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <span class="keywordflow">if</span>(max_telegram_length &lt; 256) max_telegram_length = 256;</div>
<div class="line">  <a class="code" href="classrlModbus.html#a8b8d2c8ccd15c70b3313b914b9252c09">tel</a> = <span class="keyword">new</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>[max_telegram_length];</div>
<div class="line">  <a class="code" href="classrlModbus.html#a0404de78dcd9182a39be0f7ffe23b19c">maxtel</a> = max_telegram_length;</div>
<div class="line">  <a class="code" href="classrlModbus.html#aa6a054b45000251c837abd658ef03339">mode</a> = _mode;</div>
<div class="line">  <a class="code" href="classrlModbus.html#a9777d76fbc901e32d03bbc86ca557842">delimitor</a> = end_delimitor;</div>
<div class="line">  <a class="code" href="classrlModbus.html#add9b1e7cbb325c771bdfe1ebf780d3b5">s</a> = NULL;</div>
<div class="line">  <a class="code" href="classrlModbus.html#ada836e7daccef09a72c3bf782451e160">tty</a> = NULL;</div>
<div class="line">  <a class="code" href="classrlModbus.html#a5d323c81b0dac5fd991fd28e9fb3ac80">autoreconnectSocket</a> = 1;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a4ac68440a43fa4eae5ec87bd0b9ed20c"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">rlModbus::~rlModbus </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="rlmodbus_8cpp_source.html#l00032">32</a> of file <a class="el" href="rlmodbus_8cpp_source.html">rlmodbus.cpp</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#a8b8d2c8ccd15c70b3313b914b9252c09">tel</a> != NULL) <span class="keyword">delete</span> [] <a class="code" href="classrlModbus.html#a8b8d2c8ccd15c70b3313b914b9252c09">tel</a>;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a7f0fa2807658c4fd4b7fe0a582f8c386"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int rlModbus::buf2int_ascii </td>
          <td>(</td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>buf</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="rlmodbus_8cpp_source.html#l00612">612</a> of file <a class="el" href="rlmodbus_8cpp_source.html">rlmodbus.cpp</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <span class="keywordtype">int</span> val;</div>
<div class="line"></div>
<div class="line">  sscanf((<span class="keywordtype">char</span> *) buf,<span class="stringliteral">&quot;%04X&quot;</span>,&amp;val);</div>
<div class="line">  <span class="keywordflow">return</span> val;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a4ce50e07415541dc3ce44ef6d5eb20fc"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int rlModbus::buf2int_rtu </td>
          <td>(</td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>buf</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="rlmodbus_8cpp_source.html#l00597">597</a> of file <a class="el" href="rlmodbus_8cpp_source.html">rlmodbus.cpp</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <span class="keywordflow">return</span> (buf[0]*256 + buf[1]);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af960ac56c12c00e7dd2ce0a3c3fbfb1e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int rlModbus::CRCerror </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>len</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="rlmodbus_8cpp_source.html#l00746">746</a> of file <a class="el" href="rlmodbus_8cpp_source.html">rlmodbus.cpp</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> crc_high, crc_low;</div>
<div class="line">  <span class="keywordtype">unsigned</span> index;</div>
<div class="line">  <span class="keywordtype">int</span> i;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>(len &lt; 2) <span class="keywordflow">return</span> 1;</div>
<div class="line">  crc_high = crc_low = 0xff;</div>
<div class="line">  <span class="keywordflow">for</span>(i=0; i&lt;len-2; i++)</div>
<div class="line">  {</div>
<div class="line">    index = crc_low ^ <a class="code" href="classrlModbus.html#a8b8d2c8ccd15c70b3313b914b9252c09">tel</a>[i];</div>
<div class="line">    crc_low  = crc_high ^ <a class="code" href="rlmodbus_8cpp.html#ade00722f9e0faaec45529dcf5e795fdc">array_crc_low</a>[index];</div>
<div class="line">    crc_high = <a class="code" href="rlmodbus_8cpp.html#af590facd18479d1f5bc83501861e84ba">array_crc_high</a>[index];</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">if</span>(crc_low  != <a class="code" href="classrlModbus.html#a8b8d2c8ccd15c70b3313b914b9252c09">tel</a>[len-2]) <span class="keywordflow">return</span> 1;</div>
<div class="line">  <span class="keywordflow">if</span>(crc_high != <a class="code" href="classrlModbus.html#a8b8d2c8ccd15c70b3313b914b9252c09">tel</a>[len-1]) <span class="keywordflow">return</span> 1;</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a02da348cb1bef2021a253189f55aeb11"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int rlModbus::data2int </td>
          <td>(</td>
          <td class="paramtype">const unsigned char *&#160;</td>
          <td class="paramname"><em>data</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="rlmodbus_8cpp_source.html#l00037">37</a> of file <a class="el" href="rlmodbus_8cpp_source.html">rlmodbus.cpp</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <span class="keywordflow">return</span> (data[0]*256)+data[1];</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af22f8da932f8c51dc584596f2e7e4d47"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void rlModbus::insertCRC </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>len</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="rlmodbus_8cpp_source.html#l00728">728</a> of file <a class="el" href="rlmodbus_8cpp_source.html">rlmodbus.cpp</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> crc_high, crc_low;</div>
<div class="line">  <span class="keywordtype">unsigned</span> index;</div>
<div class="line">  <span class="keywordtype">int</span> i;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>(len &lt; 0) <span class="keywordflow">return</span>;</div>
<div class="line">  crc_high = crc_low = 0xff;</div>
<div class="line">  <span class="keywordflow">for</span>(i=0; i&lt;len; i++)</div>
<div class="line">  {</div>
<div class="line">    index = crc_low ^ <a class="code" href="classrlModbus.html#a8b8d2c8ccd15c70b3313b914b9252c09">tel</a>[i];</div>
<div class="line">    crc_low  = crc_high ^ <a class="code" href="rlmodbus_8cpp.html#ade00722f9e0faaec45529dcf5e795fdc">array_crc_low</a>[index];</div>
<div class="line">    crc_high = <a class="code" href="rlmodbus_8cpp.html#af590facd18479d1f5bc83501861e84ba">array_crc_high</a>[index];</div>
<div class="line">  }</div>
<div class="line">  <a class="code" href="classrlModbus.html#a8b8d2c8ccd15c70b3313b914b9252c09">tel</a>[len]   = crc_low;</div>
<div class="line">  <a class="code" href="classrlModbus.html#a8b8d2c8ccd15c70b3313b914b9252c09">tel</a>[len+1] = crc_high;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a7fcc08ea7c9efff7529d5e9ceb5722b2"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void rlModbus::insertLRC </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>len</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="rlmodbus_8cpp_source.html#l00625">625</a> of file <a class="el" href="rlmodbus_8cpp_source.html">rlmodbus.cpp</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> lrc;</div>
<div class="line">  <span class="keywordtype">int</span> i,high,low,val;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>(len &lt; 0) <span class="keywordflow">return</span>;</div>
<div class="line">  lrc = 0;</div>
<div class="line">  <span class="keywordflow">for</span>(i=1; i&lt;len; i+=2) <span class="comment">// exclude starting &#39;:&#39; and trailing &lt;CR&gt;&lt;LF&gt;</span></div>
<div class="line">  {</div>
<div class="line">    sscanf((<span class="keyword">const</span> <span class="keywordtype">char</span> *) &amp;<a class="code" href="classrlModbus.html#a8b8d2c8ccd15c70b3313b914b9252c09">tel</a>[i],   <span class="stringliteral">&quot;%1X&quot;</span>, &amp;high);</div>
<div class="line">    sscanf((<span class="keyword">const</span> <span class="keywordtype">char</span> *) &amp;<a class="code" href="classrlModbus.html#a8b8d2c8ccd15c70b3313b914b9252c09">tel</a>[i+1], <span class="stringliteral">&quot;%1X&quot;</span>, &amp;low);</div>
<div class="line">    val = high*16 + low;</div>
<div class="line">    lrc += val;</div>
<div class="line">  }</div>
<div class="line">  lrc = ((<span class="keywordtype">unsigned</span> char)(-((<span class="keywordtype">char</span>) lrc)));</div>
<div class="line">  sprintf((<span class="keywordtype">char</span> *) &amp;<a class="code" href="classrlModbus.html#a8b8d2c8ccd15c70b3313b914b9252c09">tel</a>[len],<span class="stringliteral">&quot;%02X&quot;</span>,(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>) lrc);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac8a9fb10a9d7940eea47945a62929af6"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void rlModbus::int2buf_ascii </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>i</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>buf</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="rlmodbus_8cpp_source.html#l00620">620</a> of file <a class="el" href="rlmodbus_8cpp_source.html">rlmodbus.cpp</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  sprintf((<span class="keywordtype">char</span> *) buf,<span class="stringliteral">&quot;%04X&quot;</span>,i);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ab8548df29f72a5400bfca2a2576e171e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void rlModbus::int2buf_rtu </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>i</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>buf</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="rlmodbus_8cpp_source.html#l00602">602</a> of file <a class="el" href="rlmodbus_8cpp_source.html">rlmodbus.cpp</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <span class="keywordtype">int</span> high, low;</div>
<div class="line"></div>
<div class="line">  high = i / 256;</div>
<div class="line">  low  = i &amp; 0x0ff;</div>
<div class="line">  buf[0] = (<span class="keywordtype">unsigned</span> char) high;</div>
<div class="line">  buf[1] = (<span class="keywordtype">unsigned</span> char) low;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a3d80c0194c6836bc9419395da0daabdc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int rlModbus::int2data </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>val</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="rlmodbus_8cpp_source.html#l00042">42</a> of file <a class="el" href="rlmodbus_8cpp_source.html">rlmodbus.cpp</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  data[0] = (<span class="keywordtype">unsigned</span> char) val / 256;</div>
<div class="line">  data[1] = (<span class="keywordtype">unsigned</span> char) val &amp; 0x0ff;</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a6251a9bdb6cf258219bd324c7c8e0bb5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int rlModbus::intsize </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="rlmodbus_8cpp_source.html#l00049">49</a> of file <a class="el" href="rlmodbus_8cpp_source.html">rlmodbus.cpp</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <span class="keywordflow">return</span> 2;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ad9c8ac435545e9f724bd905c1db49f28"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int rlModbus::LRCerror </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>len</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="rlmodbus_8cpp_source.html#l00643">643</a> of file <a class="el" href="rlmodbus_8cpp_source.html">rlmodbus.cpp</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *cptr;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> lrc;</div>
<div class="line">  <span class="keywordtype">int</span> i,high,low,val;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>(len &lt; 0) <span class="keywordflow">return</span> 1;</div>
<div class="line">  <a class="code" href="classrlModbus.html#a8b8d2c8ccd15c70b3313b914b9252c09">tel</a>[<a class="code" href="classrlModbus.html#a0404de78dcd9182a39be0f7ffe23b19c">maxtel</a>-1] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line">  cptr = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *) strchr((<span class="keywordtype">char</span> *)<a class="code" href="classrlModbus.html#a8b8d2c8ccd15c70b3313b914b9252c09">tel</a>,<span class="charliteral">&#39;:&#39;</span>);</div>
<div class="line">  <span class="keywordflow">if</span>(cptr == NULL) <span class="keywordflow">return</span> 1;</div>
<div class="line">  cptr++;</div>
<div class="line">  lrc = 0;</div>
<div class="line">  <span class="keywordflow">for</span>(i=1; i&lt;len+2; i+=2) <span class="comment">// exclude starting &#39;:&#39; and trailing &lt;CR&gt;&lt;LF&gt;</span></div>
<div class="line">  {                       <span class="comment">// len is without lrc -&gt; len+2</span></div>
<div class="line">    sscanf((<span class="keyword">const</span> <span class="keywordtype">char</span> *) cptr++, <span class="stringliteral">&quot;%1X&quot;</span>, &amp;high);</div>
<div class="line">    sscanf((<span class="keyword">const</span> <span class="keywordtype">char</span> *) cptr++, <span class="stringliteral">&quot;%1X&quot;</span>, &amp;low);</div>
<div class="line">    val = high*16 + low;</div>
<div class="line">    lrc += val;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">if</span>(lrc == 0) <span class="keywordflow">return</span> 0; <span class="comment">// lrc ok</span></div>
<div class="line">  <span class="keywordflow">return</span> 1;              <span class="comment">// lrc error</span></div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af128e63b30e6ed165fb3667893c94418"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int rlModbus::readRequest </td>
          <td>(</td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>slave</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>function</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>timeout</em> = <code>1000</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>transactionID</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="rlmodbus_8cpp_source.html#l00350">350</a> of file <a class="el" href="rlmodbus_8cpp_source.html">rlmodbus.cpp</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *telptr;</div>
<div class="line">  <span class="keywordtype">int</span> ret,len,byte_count,i,itel,val;</div>
<div class="line"></div>
<div class="line">  len = 0;</div>
<div class="line">  <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#aa6a054b45000251c837abd658ef03339">mode</a> != <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab29d44112460cd074cbaa194b98c8a90">MODBUS_ASCII</a> &amp;&amp; <a class="code" href="classrlModbus.html#aa6a054b45000251c837abd658ef03339">mode</a> != <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989abd970eee924a7c780af05ab79bf94231">MODBUS_RTU</a>) <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">  <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#add9b1e7cbb325c771bdfe1ebf780d3b5">s</a> != NULL)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#add9b1e7cbb325c771bdfe1ebf780d3b5">s</a>-&gt;<a class="code" href="classrlSocket.html#a4ca3288e228e58fe41e9e64ad1c0ed6a">isConnected</a>() == 0) <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">    <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#aa6a054b45000251c837abd658ef03339">mode</a> == <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989abd970eee924a7c780af05ab79bf94231">MODBUS_RTU</a>)</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#add9b1e7cbb325c771bdfe1ebf780d3b5">s</a>-&gt;<a class="code" href="classrlSocket.html#a3ecc4e1b3cfa318693ddc9e400da0fe4">read</a>((<span class="keywordtype">char</span> *) <a class="code" href="classrlModbus.html#a8b8d2c8ccd15c70b3313b914b9252c09">tel</a>, 6, timeout) &lt;= 0) <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">      <span class="keywordflow">if</span>(transactionID != NULL) *transactionID = <a class="code" href="classrlModbus.html#a8b8d2c8ccd15c70b3313b914b9252c09">tel</a>[0] * 256 + <a class="code" href="classrlModbus.html#a8b8d2c8ccd15c70b3313b914b9252c09">tel</a>[1]; <span class="comment">// return transactionID</span></div>
<div class="line">      <span class="comment">// bytes 0,1 Transaction ID faithfully copied from the request message</span></div>
<div class="line">      <span class="comment">// bytes 2,3 Protocol number always zero</span></div>
<div class="line">      <span class="comment">// byte 4 Response length (upper byte) Always zero</span></div>
<div class="line">      <span class="comment">// byte 5 Response length (lower byte). Equal to the number of bytes which follow</span></div>
<div class="line">      <span class="comment">// Here comes the normal Modus telegram</span></div>
<div class="line">      <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#add9b1e7cbb325c771bdfe1ebf780d3b5">s</a>-&gt;<a class="code" href="classrlSocket.html#a3ecc4e1b3cfa318693ddc9e400da0fe4">read</a>((<span class="keywordtype">char</span> *) tel, 2, timeout) &lt;= 0) <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">      *slave     = tel[0];</div>
<div class="line">      *<span class="keyword">function</span>  = tel[1];</div>
<div class="line">      <span class="keywordflow">switch</span>(*<span class="keyword">function</span>)</div>
<div class="line">      {</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657ad104f9632c5253ab7a9da0bbfe123e88">ReadCoilStatus</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657af76896036e7b31809af71efc96e02c68">ReadInputStatus</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657afbc16bd1a560babc7abcecd6c17a792d">ReadHoldingRegisters</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a4264060e1f2bed5ce560206edad22d6c">ReadInputRegisters</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a885ab1a9d24d8e05107d3558ebd3e3fe">ForceSingleCoil</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a4af03846c50ff298649fefee8087e8ed">PresetSingleRegister</a>:</div>
<div class="line">          <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#add9b1e7cbb325c771bdfe1ebf780d3b5">s</a>-&gt;<a class="code" href="classrlSocket.html#a3ecc4e1b3cfa318693ddc9e400da0fe4">read</a>((<span class="keywordtype">char</span> *) data, 4, timeout) &lt;= 0)              <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">          <span class="keywordflow">return</span> 4;</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a9b5d2f1cde4cb8de72946073a21a9806">ReadExceptionStatus</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a1466463ec93749a854bfb0ce85e2acc7">FetchCommEventCtr</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a0777ef09e8622d6ce0113f11c8c3929e">FetchCommEventLog</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657ae33cbee198a6bfcc56eef4485b365016">ReportSlaveID</a>:</div>
<div class="line">          <span class="keywordflow">return</span> 0;</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a21384c6826ad985c85bbda6e22d93043">ForceMultipleCoils</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a485fed5b1927d6bf0db7311e76136fb0">PresetMultipleRegs</a>:</div>
<div class="line">          <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#add9b1e7cbb325c771bdfe1ebf780d3b5">s</a>-&gt;<a class="code" href="classrlSocket.html#a3ecc4e1b3cfa318693ddc9e400da0fe4">read</a>((<span class="keywordtype">char</span> *) data, 5, timeout) &lt;= 0)              <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">          byte_count = data[4];</div>
<div class="line">          <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#add9b1e7cbb325c771bdfe1ebf780d3b5">s</a>-&gt;<a class="code" href="classrlSocket.html#a3ecc4e1b3cfa318693ddc9e400da0fe4">read</a>((<span class="keywordtype">char</span> *) &amp;data[4], byte_count, timeout) &lt;= 0) <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">          <span class="keywordflow">return</span> 4+byte_count;</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a3c07ffeaae29454fc00ab73774be136e">ReadGeneralReference</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657ad98842ba604a74afa38555c260bb284a">WriteGeneralReference</a>:</div>
<div class="line">          <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#add9b1e7cbb325c771bdfe1ebf780d3b5">s</a>-&gt;<a class="code" href="classrlSocket.html#a3ecc4e1b3cfa318693ddc9e400da0fe4">read</a>((<span class="keywordtype">char</span> *) data, 1, timeout) &lt;= 0)              <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">          byte_count = data[0];</div>
<div class="line">          <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#add9b1e7cbb325c771bdfe1ebf780d3b5">s</a>-&gt;<a class="code" href="classrlSocket.html#a3ecc4e1b3cfa318693ddc9e400da0fe4">read</a>((<span class="keywordtype">char</span> *) data, byte_count, timeout) &lt;= 0)     <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">          <span class="keywordflow">return</span> byte_count;</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a35c8bfdb88eecf8e49d0fadfc7eaa237">MaskWrite4XRegisters</a>:</div>
<div class="line">          <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#add9b1e7cbb325c771bdfe1ebf780d3b5">s</a>-&gt;<a class="code" href="classrlSocket.html#a3ecc4e1b3cfa318693ddc9e400da0fe4">read</a>((<span class="keywordtype">char</span> *) data, 6, timeout) &lt;= 0)              <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">          <span class="keywordflow">return</span> 6;</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a9b7a98765b8b1695533cab836f7cd7b6">ReadWrite4XRegisters</a>:</div>
<div class="line">          <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#add9b1e7cbb325c771bdfe1ebf780d3b5">s</a>-&gt;<a class="code" href="classrlSocket.html#a3ecc4e1b3cfa318693ddc9e400da0fe4">read</a>((<span class="keywordtype">char</span> *) data, 9, timeout) &lt;= 0)              <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">          byte_count = data[8];</div>
<div class="line">          <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#add9b1e7cbb325c771bdfe1ebf780d3b5">s</a>-&gt;<a class="code" href="classrlSocket.html#a3ecc4e1b3cfa318693ddc9e400da0fe4">read</a>((<span class="keywordtype">char</span> *) &amp;data[8], byte_count, timeout) &lt;= 0) <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">          <span class="keywordflow">return</span> 8+byte_count;</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657afa0a0876504de7552e05ce9516cba94d">ReadFifoQueue</a>:</div>
<div class="line">          <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#add9b1e7cbb325c771bdfe1ebf780d3b5">s</a>-&gt;<a class="code" href="classrlSocket.html#a3ecc4e1b3cfa318693ddc9e400da0fe4">read</a>((<span class="keywordtype">char</span> *) data, 2, timeout) &lt;= 0)              <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">          <span class="keywordflow">return</span> 2;</div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">          <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#ada836e7daccef09a72c3bf782451e160">tty</a> != NULL)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#aa6a054b45000251c837abd658ef03339">mode</a> == <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab29d44112460cd074cbaa194b98c8a90">MODBUS_ASCII</a>)</div>
<div class="line">    {</div>
<div class="line">      <span class="comment">//printf(&quot;modbus ascii\n&quot;);</span></div>
<div class="line">      <span class="keywordflow">for</span>(i=0; i&lt;<a class="code" href="classrlModbus.html#a0404de78dcd9182a39be0f7ffe23b19c">maxtel</a>; i++)</div>
<div class="line">      {</div>
<div class="line">        ret = <a class="code" href="classrlModbus.html#ada836e7daccef09a72c3bf782451e160">tty</a>-&gt;<a class="code" href="classrlSerial.html#ad501686172ab403de1585a7a7e0bf5cd">select</a>(timeout);</div>
<div class="line">        <span class="keywordflow">if</span>(ret == 0) <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">        <span class="comment">//printf(&quot;readChar\n&quot;);</span></div>
<div class="line">        itel = <a class="code" href="classrlModbus.html#ada836e7daccef09a72c3bf782451e160">tty</a>-&gt;<a class="code" href="classrlSerial.html#a05de122779086e7f943f182829344fc4">readChar</a>();</div>
<div class="line">        <span class="keywordflow">if</span>(itel &lt; 0) <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">        tel[i] = (<span class="keywordtype">unsigned</span> char) itel;</div>
<div class="line">        <span class="keywordflow">if</span>(tel[i] == 0x0d &amp;&amp; <a class="code" href="classrlModbus.html#a9777d76fbc901e32d03bbc86ca557842">delimitor</a> != 0x0a) <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">if</span>(tel[i] == 0x0a)                      <span class="keywordflow">break</span>;</div>
<div class="line">      }</div>
<div class="line">      tel[i] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line">      telptr = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *) strchr((<span class="keyword">const</span> <span class="keywordtype">char</span> *) <a class="code" href="classrlModbus.html#a8b8d2c8ccd15c70b3313b914b9252c09">tel</a>,<span class="charliteral">&#39;:&#39;</span>);</div>
<div class="line">      <span class="keywordflow">if</span>(telptr == NULL) <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">      len++;</div>
<div class="line">      sscanf((<span class="keywordtype">char</span> *) &amp;telptr[len],<span class="stringliteral">&quot;%02X&quot;</span>,slave);       len += 2;</div>
<div class="line">      sscanf((<span class="keywordtype">char</span> *) &amp;telptr[len],<span class="stringliteral">&quot;%02X&quot;</span>,<span class="keyword">function</span>);    len += 2;</div>
<div class="line">      <span class="keywordflow">switch</span>(*<span class="keyword">function</span>)</div>
<div class="line">      {</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657ad104f9632c5253ab7a9da0bbfe123e88">ReadCoilStatus</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657af76896036e7b31809af71efc96e02c68">ReadInputStatus</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657afbc16bd1a560babc7abcecd6c17a792d">ReadHoldingRegisters</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a4264060e1f2bed5ce560206edad22d6c">ReadInputRegisters</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a885ab1a9d24d8e05107d3558ebd3e3fe">ForceSingleCoil</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a4af03846c50ff298649fefee8087e8ed">PresetSingleRegister</a>:</div>
<div class="line">          sscanf((<span class="keywordtype">char</span> *) &amp;telptr[len],<span class="stringliteral">&quot;%02X&quot;</span>,&amp;val); data[0] = (<span class="keywordtype">unsigned</span> char) val; len += 2;</div>
<div class="line">          sscanf((<span class="keywordtype">char</span> *) &amp;telptr[len],<span class="stringliteral">&quot;%02X&quot;</span>,&amp;val); data[1] = (<span class="keywordtype">unsigned</span> char) val; len += 2;</div>
<div class="line">          sscanf((<span class="keywordtype">char</span> *) &amp;telptr[len],<span class="stringliteral">&quot;%02X&quot;</span>,&amp;val); data[2] = (<span class="keywordtype">unsigned</span> char) val; len += 2;</div>
<div class="line">          sscanf((<span class="keywordtype">char</span> *) &amp;telptr[len],<span class="stringliteral">&quot;%02X&quot;</span>,&amp;val); data[3] = (<span class="keywordtype">unsigned</span> char) val; len += 2;</div>
<div class="line">          <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#ad9c8ac435545e9f724bd905c1db49f28">LRCerror</a>(len) == 1) <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989a7e0314efdf6912fcc42895797b03f6fa">MODBUS_CHECKSUM_ERROR</a>;</div>
<div class="line">          <span class="keywordflow">return</span> 4;</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a9b5d2f1cde4cb8de72946073a21a9806">ReadExceptionStatus</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a1466463ec93749a854bfb0ce85e2acc7">FetchCommEventCtr</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a0777ef09e8622d6ce0113f11c8c3929e">FetchCommEventLog</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657ae33cbee198a6bfcc56eef4485b365016">ReportSlaveID</a>:</div>
<div class="line">          <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#ad9c8ac435545e9f724bd905c1db49f28">LRCerror</a>(len) == 1) <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989a7e0314efdf6912fcc42895797b03f6fa">MODBUS_CHECKSUM_ERROR</a>;</div>
<div class="line">          <span class="keywordflow">return</span> 0;</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a21384c6826ad985c85bbda6e22d93043">ForceMultipleCoils</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a485fed5b1927d6bf0db7311e76136fb0">PresetMultipleRegs</a>:</div>
<div class="line">          sscanf((<span class="keywordtype">char</span> *) &amp;telptr[len],<span class="stringliteral">&quot;%02X&quot;</span>,&amp;val); data[0] = (<span class="keywordtype">unsigned</span> char) val; len += 2;</div>
<div class="line">          sscanf((<span class="keywordtype">char</span> *) &amp;telptr[len],<span class="stringliteral">&quot;%02X&quot;</span>,&amp;val); data[1] = (<span class="keywordtype">unsigned</span> char) val; len += 2;</div>
<div class="line">          sscanf((<span class="keywordtype">char</span> *) &amp;telptr[len],<span class="stringliteral">&quot;%02X&quot;</span>,&amp;val); data[2] = (<span class="keywordtype">unsigned</span> char) val; len += 2;</div>
<div class="line">          sscanf((<span class="keywordtype">char</span> *) &amp;telptr[len],<span class="stringliteral">&quot;%02X&quot;</span>,&amp;val); data[3] = (<span class="keywordtype">unsigned</span> char) val; len += 2;</div>
<div class="line">          sscanf((<span class="keywordtype">char</span> *) &amp;telptr[len],<span class="stringliteral">&quot;%02X&quot;</span>,&amp;byte_count);                         len += 2;</div>
<div class="line">          <span class="keywordflow">for</span>(i=0; i&lt;byte_count; i++)</div>
<div class="line">          {</div>
<div class="line">            sscanf((<span class="keywordtype">char</span> *) &amp;telptr[len],<span class="stringliteral">&quot;%02X&quot;</span>,&amp;val); data[4+i] = (<span class="keywordtype">unsigned</span> char) val; len += 2;</div>
<div class="line">          }</div>
<div class="line">          <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#ad9c8ac435545e9f724bd905c1db49f28">LRCerror</a>(len) == 1) <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989a7e0314efdf6912fcc42895797b03f6fa">MODBUS_CHECKSUM_ERROR</a>;</div>
<div class="line">          <span class="keywordflow">return</span> 4+byte_count;</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a3c07ffeaae29454fc00ab73774be136e">ReadGeneralReference</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657ad98842ba604a74afa38555c260bb284a">WriteGeneralReference</a>:</div>
<div class="line">          sscanf((<span class="keywordtype">char</span> *) &amp;telptr[len],<span class="stringliteral">&quot;%02X&quot;</span>,&amp;byte_count);                           len += 2;</div>
<div class="line">          <span class="keywordflow">for</span>(i=0; i&lt;byte_count; i++)</div>
<div class="line">          {</div>
<div class="line">            sscanf((<span class="keywordtype">char</span> *) &amp;telptr[len],<span class="stringliteral">&quot;%02X&quot;</span>,&amp;val); data[i] = (<span class="keywordtype">unsigned</span> char) val; len += 2;</div>
<div class="line">          }</div>
<div class="line">          <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#ad9c8ac435545e9f724bd905c1db49f28">LRCerror</a>(len) == 1) <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989a7e0314efdf6912fcc42895797b03f6fa">MODBUS_CHECKSUM_ERROR</a>;</div>
<div class="line">          <span class="keywordflow">return</span> byte_count;</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a35c8bfdb88eecf8e49d0fadfc7eaa237">MaskWrite4XRegisters</a>:</div>
<div class="line">          sscanf((<span class="keywordtype">char</span> *) &amp;telptr[len],<span class="stringliteral">&quot;%02X&quot;</span>,&amp;val); data[0] = (<span class="keywordtype">unsigned</span> char) val; len += 2;</div>
<div class="line">          sscanf((<span class="keywordtype">char</span> *) &amp;telptr[len],<span class="stringliteral">&quot;%02X&quot;</span>,&amp;val); data[1] = (<span class="keywordtype">unsigned</span> char) val; len += 2;</div>
<div class="line">          sscanf((<span class="keywordtype">char</span> *) &amp;telptr[len],<span class="stringliteral">&quot;%02X&quot;</span>,&amp;val); data[2] = (<span class="keywordtype">unsigned</span> char) val; len += 2;</div>
<div class="line">          sscanf((<span class="keywordtype">char</span> *) &amp;telptr[len],<span class="stringliteral">&quot;%02X&quot;</span>,&amp;val); data[3] = (<span class="keywordtype">unsigned</span> char) val; len += 2;</div>
<div class="line">          sscanf((<span class="keywordtype">char</span> *) &amp;telptr[len],<span class="stringliteral">&quot;%02X&quot;</span>,&amp;val); data[4] = (<span class="keywordtype">unsigned</span> char) val; len += 2;</div>
<div class="line">          sscanf((<span class="keywordtype">char</span> *) &amp;telptr[len],<span class="stringliteral">&quot;%02X&quot;</span>,&amp;val); data[5] = (<span class="keywordtype">unsigned</span> char) val; len += 2;</div>
<div class="line">          <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#ad9c8ac435545e9f724bd905c1db49f28">LRCerror</a>(len) == 1) <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989a7e0314efdf6912fcc42895797b03f6fa">MODBUS_CHECKSUM_ERROR</a>;</div>
<div class="line">          <span class="keywordflow">return</span> 6;</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a9b7a98765b8b1695533cab836f7cd7b6">ReadWrite4XRegisters</a>:</div>
<div class="line">          sscanf((<span class="keywordtype">char</span> *) &amp;telptr[len],<span class="stringliteral">&quot;%02X&quot;</span>,&amp;val); data[0] = (<span class="keywordtype">unsigned</span> char) val; len += 2;</div>
<div class="line">          sscanf((<span class="keywordtype">char</span> *) &amp;telptr[len],<span class="stringliteral">&quot;%02X&quot;</span>,&amp;val); data[1] = (<span class="keywordtype">unsigned</span> char) val; len += 2;</div>
<div class="line">          sscanf((<span class="keywordtype">char</span> *) &amp;telptr[len],<span class="stringliteral">&quot;%02X&quot;</span>,&amp;val); data[2] = (<span class="keywordtype">unsigned</span> char) val; len += 2;</div>
<div class="line">          sscanf((<span class="keywordtype">char</span> *) &amp;telptr[len],<span class="stringliteral">&quot;%02X&quot;</span>,&amp;val); data[3] = (<span class="keywordtype">unsigned</span> char) val; len += 2;</div>
<div class="line">          sscanf((<span class="keywordtype">char</span> *) &amp;telptr[len],<span class="stringliteral">&quot;%02X&quot;</span>,&amp;val); data[4] = (<span class="keywordtype">unsigned</span> char) val; len += 2;</div>
<div class="line">          sscanf((<span class="keywordtype">char</span> *) &amp;telptr[len],<span class="stringliteral">&quot;%02X&quot;</span>,&amp;val); data[5] = (<span class="keywordtype">unsigned</span> char) val; len += 2;</div>
<div class="line">          sscanf((<span class="keywordtype">char</span> *) &amp;telptr[len],<span class="stringliteral">&quot;%02X&quot;</span>,&amp;val); data[6] = (<span class="keywordtype">unsigned</span> char) val; len += 2;</div>
<div class="line">          sscanf((<span class="keywordtype">char</span> *) &amp;telptr[len],<span class="stringliteral">&quot;%02X&quot;</span>,&amp;val); data[7] = (<span class="keywordtype">unsigned</span> char) val; len += 2;</div>
<div class="line">          sscanf((<span class="keywordtype">char</span> *) &amp;telptr[len],<span class="stringliteral">&quot;%02X&quot;</span>,&amp;byte_count);                         len += 2;</div>
<div class="line">          <span class="keywordflow">for</span>(i=0; i&lt;byte_count; i++)</div>
<div class="line">          {</div>
<div class="line">            sscanf((<span class="keywordtype">char</span> *) &amp;telptr[len],<span class="stringliteral">&quot;%02X&quot;</span>,&amp;val); data[8+i] = (<span class="keywordtype">unsigned</span> char) val; len += 2;</div>
<div class="line">          }</div>
<div class="line">          <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#ad9c8ac435545e9f724bd905c1db49f28">LRCerror</a>(len) == 1) <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989a7e0314efdf6912fcc42895797b03f6fa">MODBUS_CHECKSUM_ERROR</a>;</div>
<div class="line">          <span class="keywordflow">return</span> 8+byte_count;</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657afa0a0876504de7552e05ce9516cba94d">ReadFifoQueue</a>:</div>
<div class="line">          sscanf((<span class="keywordtype">char</span> *) &amp;telptr[len],<span class="stringliteral">&quot;%02X&quot;</span>,&amp;val); data[0] = (<span class="keywordtype">unsigned</span> char) val; len += 2;</div>
<div class="line">          sscanf((<span class="keywordtype">char</span> *) &amp;telptr[len],<span class="stringliteral">&quot;%02X&quot;</span>,&amp;val); data[1] = (<span class="keywordtype">unsigned</span> char) val; len += 2;</div>
<div class="line">          <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#ad9c8ac435545e9f724bd905c1db49f28">LRCerror</a>(len) == 1) <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989a7e0314efdf6912fcc42895797b03f6fa">MODBUS_CHECKSUM_ERROR</a>;</div>
<div class="line">          <span class="keywordflow">return</span> 2;</div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">          <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#aa6a054b45000251c837abd658ef03339">mode</a> == <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989abd970eee924a7c780af05ab79bf94231">MODBUS_RTU</a>)</div>
<div class="line">    {</div>
<div class="line">      ret = <a class="code" href="classrlModbus.html#ada836e7daccef09a72c3bf782451e160">tty</a>-&gt;<a class="code" href="classrlSerial.html#ad501686172ab403de1585a7a7e0bf5cd">select</a>(timeout);</div>
<div class="line">      <span class="keywordflow">if</span>(ret == 0)                             <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">      <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#ada836e7daccef09a72c3bf782451e160">tty</a>-&gt;<a class="code" href="classrlSerial.html#a4bd5a244a78c06b17976f13ef93aaf54">readBlock</a>(tel, 2, timeout) &lt;= 0) <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">      *slave     = tel[len++];</div>
<div class="line">      *<span class="keyword">function</span>  = tel[len++];</div>
<div class="line">      ret = <a class="code" href="classrlModbus.html#ada836e7daccef09a72c3bf782451e160">tty</a>-&gt;<a class="code" href="classrlSerial.html#ad501686172ab403de1585a7a7e0bf5cd">select</a>(timeout);</div>
<div class="line">      <span class="keywordflow">if</span>(ret == 0)                    <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">      <span class="keywordflow">switch</span>(*<span class="keyword">function</span>)</div>
<div class="line">      {</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657ad104f9632c5253ab7a9da0bbfe123e88">ReadCoilStatus</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657af76896036e7b31809af71efc96e02c68">ReadInputStatus</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657afbc16bd1a560babc7abcecd6c17a792d">ReadHoldingRegisters</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a4264060e1f2bed5ce560206edad22d6c">ReadInputRegisters</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a885ab1a9d24d8e05107d3558ebd3e3fe">ForceSingleCoil</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a4af03846c50ff298649fefee8087e8ed">PresetSingleRegister</a>:</div>
<div class="line">          <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#ada836e7daccef09a72c3bf782451e160">tty</a>-&gt;<a class="code" href="classrlSerial.html#a4bd5a244a78c06b17976f13ef93aaf54">readBlock</a>(data, 4+2, timeout) &lt;= 0)              <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">          memcpy(&amp;tel[len],data,4+2); len += 4+2;</div>
<div class="line">          <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#af960ac56c12c00e7dd2ce0a3c3fbfb1e">CRCerror</a>(len) == 1)                          <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989a7e0314efdf6912fcc42895797b03f6fa">MODBUS_CHECKSUM_ERROR</a>;</div>
<div class="line">          <span class="keywordflow">return</span> 4;</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a9b5d2f1cde4cb8de72946073a21a9806">ReadExceptionStatus</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a1466463ec93749a854bfb0ce85e2acc7">FetchCommEventCtr</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a0777ef09e8622d6ce0113f11c8c3929e">FetchCommEventLog</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657ae33cbee198a6bfcc56eef4485b365016">ReportSlaveID</a>:</div>
<div class="line">          <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#af960ac56c12c00e7dd2ce0a3c3fbfb1e">CRCerror</a>(len) == 1)                          <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989a7e0314efdf6912fcc42895797b03f6fa">MODBUS_CHECKSUM_ERROR</a>;</div>
<div class="line">          <span class="keywordflow">return</span> 0;</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a21384c6826ad985c85bbda6e22d93043">ForceMultipleCoils</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a485fed5b1927d6bf0db7311e76136fb0">PresetMultipleRegs</a>:</div>
<div class="line">          <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#ada836e7daccef09a72c3bf782451e160">tty</a>-&gt;<a class="code" href="classrlSerial.html#a4bd5a244a78c06b17976f13ef93aaf54">readBlock</a>(data, 5, timeout) &lt;= 0)                <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">          memcpy(&amp;tel[len],data,5); len += 5;</div>
<div class="line">          byte_count = data[4];</div>
<div class="line">          <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#ada836e7daccef09a72c3bf782451e160">tty</a>-&gt;<a class="code" href="classrlSerial.html#a4bd5a244a78c06b17976f13ef93aaf54">readBlock</a>(&amp;data[4], byte_count+2, timeout) &lt;= 0) <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">          memcpy(&amp;tel[len],data,byte_count+2); len += byte_count+2;</div>
<div class="line">          <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#af960ac56c12c00e7dd2ce0a3c3fbfb1e">CRCerror</a>(len) == 1)                          <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989a7e0314efdf6912fcc42895797b03f6fa">MODBUS_CHECKSUM_ERROR</a>;</div>
<div class="line">          <span class="keywordflow">return</span> 4+byte_count;</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a3c07ffeaae29454fc00ab73774be136e">ReadGeneralReference</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657ad98842ba604a74afa38555c260bb284a">WriteGeneralReference</a>:</div>
<div class="line">          <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#ada836e7daccef09a72c3bf782451e160">tty</a>-&gt;<a class="code" href="classrlSerial.html#a4bd5a244a78c06b17976f13ef93aaf54">readBlock</a>(data, 1, timeout) &lt;= 0)                <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">          memcpy(&amp;tel[len],data,1); len++;</div>
<div class="line">          byte_count = data[0];</div>
<div class="line">          <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#ada836e7daccef09a72c3bf782451e160">tty</a>-&gt;<a class="code" href="classrlSerial.html#a4bd5a244a78c06b17976f13ef93aaf54">readBlock</a>(data, byte_count+2, timeout) &lt;= 0)     <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">          memcpy(&amp;tel[len],data,byte_count+2); len += byte_count+2;</div>
<div class="line">          <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#af960ac56c12c00e7dd2ce0a3c3fbfb1e">CRCerror</a>(len) == 1)                          <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989a7e0314efdf6912fcc42895797b03f6fa">MODBUS_CHECKSUM_ERROR</a>;</div>
<div class="line">          <span class="keywordflow">return</span> byte_count;</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a35c8bfdb88eecf8e49d0fadfc7eaa237">MaskWrite4XRegisters</a>:</div>
<div class="line">          <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#ada836e7daccef09a72c3bf782451e160">tty</a>-&gt;<a class="code" href="classrlSerial.html#a4bd5a244a78c06b17976f13ef93aaf54">readBlock</a>(data, 6+2, timeout) &lt;= 0)              <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">          memcpy(&amp;tel[len],data,6+2); len += 6+2;</div>
<div class="line">          <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#af960ac56c12c00e7dd2ce0a3c3fbfb1e">CRCerror</a>(len) == 1)                          <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989a7e0314efdf6912fcc42895797b03f6fa">MODBUS_CHECKSUM_ERROR</a>;</div>
<div class="line">          <span class="keywordflow">return</span> 6;</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a9b7a98765b8b1695533cab836f7cd7b6">ReadWrite4XRegisters</a>:</div>
<div class="line">          <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#ada836e7daccef09a72c3bf782451e160">tty</a>-&gt;<a class="code" href="classrlSerial.html#a4bd5a244a78c06b17976f13ef93aaf54">readBlock</a>(data, 9, timeout) &lt;= 0)                <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">          memcpy(&amp;tel[len],data,9); len += 9;</div>
<div class="line">          byte_count = data[8];</div>
<div class="line">          <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#ada836e7daccef09a72c3bf782451e160">tty</a>-&gt;<a class="code" href="classrlSerial.html#a4bd5a244a78c06b17976f13ef93aaf54">readBlock</a>(&amp;data[8], byte_count+2, timeout) &lt;= 0) <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">          memcpy(&amp;tel[len],data,byte_count+2); len += byte_count+2;</div>
<div class="line">          <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#af960ac56c12c00e7dd2ce0a3c3fbfb1e">CRCerror</a>(len) == 1)                          <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989a7e0314efdf6912fcc42895797b03f6fa">MODBUS_CHECKSUM_ERROR</a>;</div>
<div class="line">          <span class="keywordflow">return</span> 8+byte_count;</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657afa0a0876504de7552e05ce9516cba94d">ReadFifoQueue</a>:</div>
<div class="line">          <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#ada836e7daccef09a72c3bf782451e160">tty</a>-&gt;<a class="code" href="classrlSerial.html#a4bd5a244a78c06b17976f13ef93aaf54">readBlock</a>(data, 2+2, timeout) &lt;= 0)              <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">          memcpy(&amp;tel[len],data,2+2); len += 2+2;</div>
<div class="line">          <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#af960ac56c12c00e7dd2ce0a3c3fbfb1e">CRCerror</a>(len) == 1)                          <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989a7e0314efdf6912fcc42895797b03f6fa">MODBUS_CHECKSUM_ERROR</a>;</div>
<div class="line">          <span class="keywordflow">return</span> 2;</div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">          <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">else</span> <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">  <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ae5c1eaaf0071d082751fcdcfa624e52f">MODBUS_SUCCESS</a>;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a1617b6cea5012eafc150ab11ae7ccf87"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rlModbus::registerSerial </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classrlSerial.html">rlSerial</a> *&#160;</td>
          <td class="paramname"><em>serial</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="rlmodbus_8cpp_source.html#l00591">591</a> of file <a class="el" href="rlmodbus_8cpp_source.html">rlmodbus.cpp</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <a class="code" href="classrlModbus.html#add9b1e7cbb325c771bdfe1ebf780d3b5">s</a> = NULL;</div>
<div class="line">  <a class="code" href="classrlModbus.html#ada836e7daccef09a72c3bf782451e160">tty</a> = serial;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a5ce8a4c1476a6bbc5196422cc01f044a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rlModbus::registerSocket </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classrlSocket.html">rlSocket</a> *&#160;</td>
          <td class="paramname"><em>socket</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="rlmodbus_8cpp_source.html#l00585">585</a> of file <a class="el" href="rlmodbus_8cpp_source.html">rlmodbus.cpp</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <a class="code" href="classrlModbus.html#ada836e7daccef09a72c3bf782451e160">tty</a> = NULL;</div>
<div class="line">  <a class="code" href="classrlModbus.html#add9b1e7cbb325c771bdfe1ebf780d3b5">s</a> = socket;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af372c588b1805e831a7f3a6fc7760b58"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int rlModbus::request </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>slave</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>function</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>start_adr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>num_register</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="rlmodbus_8cpp_source.html#l00121">121</a> of file <a class="el" href="rlmodbus_8cpp_source.html">rlmodbus.cpp</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> data[4];</div>
<div class="line"></div>
<div class="line">  data[0] = (<span class="keywordtype">unsigned</span> char) ( start_adr / 256 );</div>
<div class="line">  data[1] = (<span class="keywordtype">unsigned</span> char) ( start_adr &amp; 0x0ff );</div>
<div class="line">  data[2] = (<span class="keywordtype">unsigned</span> char) ( num_register / 256 ); </div>
<div class="line">  data[3] = (<span class="keywordtype">unsigned</span> char) ( num_register &amp; 0x0ff );</div>
<div class="line">  <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a7efc504fc4759fc04add6b33d64bf28c">write</a>(slave, <span class="keyword">function</span>, data, 4);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ad4b7dd434f85952ed1cc7ade9a606fa1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int rlModbus::response </td>
          <td>(</td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>slave</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>function</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>timeout</em> = <code>1000</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="rlmodbus_8cpp_source.html#l00132">132</a> of file <a class="el" href="rlmodbus_8cpp_source.html">rlmodbus.cpp</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *telptr;</div>
<div class="line">  <span class="keywordtype">int</span> ret,len,byte_count,idata,i,itel,val;</div>
<div class="line"></div>
<div class="line">  len = 0;</div>
<div class="line">  <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#aa6a054b45000251c837abd658ef03339">mode</a> != <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab29d44112460cd074cbaa194b98c8a90">MODBUS_ASCII</a> &amp;&amp; <a class="code" href="classrlModbus.html#aa6a054b45000251c837abd658ef03339">mode</a> != <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989abd970eee924a7c780af05ab79bf94231">MODBUS_RTU</a>) <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">  <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#add9b1e7cbb325c771bdfe1ebf780d3b5">s</a> != NULL)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#add9b1e7cbb325c771bdfe1ebf780d3b5">s</a>-&gt;<a class="code" href="classrlSocket.html#a4ca3288e228e58fe41e9e64ad1c0ed6a">isConnected</a>() == 0) <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">    <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#aa6a054b45000251c837abd658ef03339">mode</a> == <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989abd970eee924a7c780af05ab79bf94231">MODBUS_RTU</a>)</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#add9b1e7cbb325c771bdfe1ebf780d3b5">s</a>-&gt;<a class="code" href="classrlSocket.html#a3ecc4e1b3cfa318693ddc9e400da0fe4">read</a>((<span class="keywordtype">char</span> *) <a class="code" href="classrlModbus.html#a8b8d2c8ccd15c70b3313b914b9252c09">tel</a>, 6, timeout) &lt;= 0) <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">      <span class="comment">// bytes 0,1 Transaction ID faithfully copied from the request message</span></div>
<div class="line">      <span class="comment">// bytes 2,3 Protocol number always zero</span></div>
<div class="line">      <span class="comment">// byte 4 Response length (upper byte) Always zero</span></div>
<div class="line">      <span class="comment">// byte 5 Response length (lower byte). Equal to the number of bytes which follow</span></div>
<div class="line">      <span class="comment">// Here comes the normal Modus telegram</span></div>
<div class="line">      <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#add9b1e7cbb325c771bdfe1ebf780d3b5">s</a>-&gt;<a class="code" href="classrlSocket.html#a3ecc4e1b3cfa318693ddc9e400da0fe4">read</a>((<span class="keywordtype">char</span> *) <a class="code" href="classrlModbus.html#a8b8d2c8ccd15c70b3313b914b9252c09">tel</a>, 2, timeout) &lt;= 0) <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">      *slave     = <a class="code" href="classrlModbus.html#a8b8d2c8ccd15c70b3313b914b9252c09">tel</a>[0];</div>
<div class="line">      *<span class="keyword">function</span>  = <a class="code" href="classrlModbus.html#a8b8d2c8ccd15c70b3313b914b9252c09">tel</a>[1];</div>
<div class="line">      <span class="keywordflow">switch</span>(*<span class="keyword">function</span>)</div>
<div class="line">      {</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657ad104f9632c5253ab7a9da0bbfe123e88">ReadCoilStatus</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657af76896036e7b31809af71efc96e02c68">ReadInputStatus</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657afbc16bd1a560babc7abcecd6c17a792d">ReadHoldingRegisters</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a4264060e1f2bed5ce560206edad22d6c">ReadInputRegisters</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a0777ef09e8622d6ce0113f11c8c3929e">FetchCommEventLog</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657ae33cbee198a6bfcc56eef4485b365016">ReportSlaveID</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a3c07ffeaae29454fc00ab73774be136e">ReadGeneralReference</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657ad98842ba604a74afa38555c260bb284a">WriteGeneralReference</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a9b7a98765b8b1695533cab836f7cd7b6">ReadWrite4XRegisters</a>:</div>
<div class="line">          <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#add9b1e7cbb325c771bdfe1ebf780d3b5">s</a>-&gt;<a class="code" href="classrlSocket.html#a3ecc4e1b3cfa318693ddc9e400da0fe4">read</a>((<span class="keywordtype">char</span> *) <a class="code" href="classrlModbus.html#a8b8d2c8ccd15c70b3313b914b9252c09">tel</a>, 1, timeout) &lt;= 0)            <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">          byte_count = <a class="code" href="classrlModbus.html#a8b8d2c8ccd15c70b3313b914b9252c09">tel</a>[0];</div>
<div class="line">          <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#add9b1e7cbb325c771bdfe1ebf780d3b5">s</a>-&gt;<a class="code" href="classrlSocket.html#a3ecc4e1b3cfa318693ddc9e400da0fe4">read</a>((<span class="keywordtype">char</span> *) data, byte_count, timeout) &lt;= 0)  <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">          <span class="keywordflow">return</span> byte_count;</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a885ab1a9d24d8e05107d3558ebd3e3fe">ForceSingleCoil</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a4af03846c50ff298649fefee8087e8ed">PresetSingleRegister</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a1466463ec93749a854bfb0ce85e2acc7">FetchCommEventCtr</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a21384c6826ad985c85bbda6e22d93043">ForceMultipleCoils</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a485fed5b1927d6bf0db7311e76136fb0">PresetMultipleRegs</a>:</div>
<div class="line">          byte_count = 4;</div>
<div class="line">          <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#add9b1e7cbb325c771bdfe1ebf780d3b5">s</a>-&gt;<a class="code" href="classrlSocket.html#a3ecc4e1b3cfa318693ddc9e400da0fe4">read</a>((<span class="keywordtype">char</span> *) data, byte_count, timeout) &lt;= 0)  <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">          <span class="keywordflow">return</span> byte_count;</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a9b5d2f1cde4cb8de72946073a21a9806">ReadExceptionStatus</a>:</div>
<div class="line">          byte_count = 1;</div>
<div class="line">          <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#add9b1e7cbb325c771bdfe1ebf780d3b5">s</a>-&gt;<a class="code" href="classrlSocket.html#a3ecc4e1b3cfa318693ddc9e400da0fe4">read</a>((<span class="keywordtype">char</span> *) data, byte_count, timeout) &lt;= 0)  <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">          <span class="keywordflow">return</span> byte_count;</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a35c8bfdb88eecf8e49d0fadfc7eaa237">MaskWrite4XRegisters</a>:</div>
<div class="line">          byte_count = 6;</div>
<div class="line">          <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#add9b1e7cbb325c771bdfe1ebf780d3b5">s</a>-&gt;<a class="code" href="classrlSocket.html#a3ecc4e1b3cfa318693ddc9e400da0fe4">read</a>((<span class="keywordtype">char</span> *) data, byte_count, timeout) &lt;= 0)  <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">          <span class="keywordflow">return</span> byte_count;</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657afa0a0876504de7552e05ce9516cba94d">ReadFifoQueue</a>:</div>
<div class="line">          <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#add9b1e7cbb325c771bdfe1ebf780d3b5">s</a>-&gt;<a class="code" href="classrlSocket.html#a3ecc4e1b3cfa318693ddc9e400da0fe4">read</a>((<span class="keywordtype">char</span> *) <a class="code" href="classrlModbus.html#a8b8d2c8ccd15c70b3313b914b9252c09">tel</a>, 2, timeout) &lt;= 0)            <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">          byte_count = <a class="code" href="classrlModbus.html#a8b8d2c8ccd15c70b3313b914b9252c09">tel</a>[0]*256 + <a class="code" href="classrlModbus.html#a8b8d2c8ccd15c70b3313b914b9252c09">tel</a>[1];</div>
<div class="line">          <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#add9b1e7cbb325c771bdfe1ebf780d3b5">s</a>-&gt;<a class="code" href="classrlSocket.html#a3ecc4e1b3cfa318693ddc9e400da0fe4">read</a>((<span class="keywordtype">char</span> *) data, byte_count, timeout) &lt;= 0)  <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">          <span class="keywordflow">return</span> byte_count;</div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">          <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#ada836e7daccef09a72c3bf782451e160">tty</a> != NULL)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#aa6a054b45000251c837abd658ef03339">mode</a> == <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab29d44112460cd074cbaa194b98c8a90">MODBUS_ASCII</a>)</div>
<div class="line">    {</div>
<div class="line">      <span class="comment">//printf(&quot;modbus ascii\n&quot;);</span></div>
<div class="line">      <span class="keywordflow">for</span>(i=0; i&lt;<a class="code" href="classrlModbus.html#a0404de78dcd9182a39be0f7ffe23b19c">maxtel</a>; i++)</div>
<div class="line">      {</div>
<div class="line">        ret = <a class="code" href="classrlModbus.html#ada836e7daccef09a72c3bf782451e160">tty</a>-&gt;<a class="code" href="classrlSerial.html#ad501686172ab403de1585a7a7e0bf5cd">select</a>(timeout);</div>
<div class="line">        <span class="keywordflow">if</span>(ret == 0) <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">        <span class="comment">//printf(&quot;readChar\n&quot;);</span></div>
<div class="line">        itel = <a class="code" href="classrlModbus.html#ada836e7daccef09a72c3bf782451e160">tty</a>-&gt;<a class="code" href="classrlSerial.html#a05de122779086e7f943f182829344fc4">readChar</a>();</div>
<div class="line">        <span class="keywordflow">if</span>(itel &lt; 0) <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">        <a class="code" href="classrlModbus.html#a8b8d2c8ccd15c70b3313b914b9252c09">tel</a>[i] = (<span class="keywordtype">unsigned</span> char) itel;</div>
<div class="line">        <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#a8b8d2c8ccd15c70b3313b914b9252c09">tel</a>[i] == 0x0d &amp;&amp; <a class="code" href="classrlModbus.html#a9777d76fbc901e32d03bbc86ca557842">delimitor</a> != 0x0a) <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#a8b8d2c8ccd15c70b3313b914b9252c09">tel</a>[i] == 0x0a)                      <span class="keywordflow">break</span>;</div>
<div class="line">      }</div>
<div class="line">      <a class="code" href="classrlModbus.html#a8b8d2c8ccd15c70b3313b914b9252c09">tel</a>[i] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line">      telptr = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *) strchr((<span class="keyword">const</span> <span class="keywordtype">char</span> *) <a class="code" href="classrlModbus.html#a8b8d2c8ccd15c70b3313b914b9252c09">tel</a>,<span class="charliteral">&#39;:&#39;</span>);</div>
<div class="line">      <span class="keywordflow">if</span>(telptr == NULL) <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">      len++;</div>
<div class="line">      sscanf((<span class="keywordtype">char</span> *) &amp;telptr[len],<span class="stringliteral">&quot;%02X&quot;</span>,slave);       len += 2;</div>
<div class="line">      sscanf((<span class="keywordtype">char</span> *) &amp;telptr[len],<span class="stringliteral">&quot;%02X&quot;</span>,<span class="keyword">function</span>);    len += 2;</div>
<div class="line">      <span class="keywordflow">switch</span>(*<span class="keyword">function</span>)</div>
<div class="line">      {</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657ad104f9632c5253ab7a9da0bbfe123e88">ReadCoilStatus</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657af76896036e7b31809af71efc96e02c68">ReadInputStatus</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657afbc16bd1a560babc7abcecd6c17a792d">ReadHoldingRegisters</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a4264060e1f2bed5ce560206edad22d6c">ReadInputRegisters</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a0777ef09e8622d6ce0113f11c8c3929e">FetchCommEventLog</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657ae33cbee198a6bfcc56eef4485b365016">ReportSlaveID</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a3c07ffeaae29454fc00ab73774be136e">ReadGeneralReference</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657ad98842ba604a74afa38555c260bb284a">WriteGeneralReference</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a9b7a98765b8b1695533cab836f7cd7b6">ReadWrite4XRegisters</a>:</div>
<div class="line">          sscanf((<span class="keywordtype">char</span> *) &amp;telptr[len],<span class="stringliteral">&quot;%02X&quot;</span>,&amp;byte_count);    len += 2;</div>
<div class="line">          <span class="keywordflow">for</span>(idata=0; idata&lt;byte_count; idata++)</div>
<div class="line">          {</div>
<div class="line">            sscanf((<span class="keyword">const</span> <span class="keywordtype">char</span> *) &amp;telptr[len], <span class="stringliteral">&quot;%02X&quot;</span>, &amp;val); len += 2;</div>
<div class="line">            data[idata] = val;</div>
<div class="line">          }</div>
<div class="line">          data[idata] = 0x0ff; <span class="comment">// terminator, this data can&#39;t come over modbus</span></div>
<div class="line">          <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#ad9c8ac435545e9f724bd905c1db49f28">LRCerror</a>(len) == 1) <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989a7e0314efdf6912fcc42895797b03f6fa">MODBUS_CHECKSUM_ERROR</a>;</div>
<div class="line">          <span class="keywordflow">return</span> byte_count;</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a885ab1a9d24d8e05107d3558ebd3e3fe">ForceSingleCoil</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a4af03846c50ff298649fefee8087e8ed">PresetSingleRegister</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a1466463ec93749a854bfb0ce85e2acc7">FetchCommEventCtr</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a21384c6826ad985c85bbda6e22d93043">ForceMultipleCoils</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a485fed5b1927d6bf0db7311e76136fb0">PresetMultipleRegs</a>:</div>
<div class="line">          byte_count = 8;</div>
<div class="line">          <span class="keywordflow">for</span>(idata=0; idata&lt;(byte_count/2); idata++)</div>
<div class="line">          {</div>
<div class="line">            data[idata] = <a class="code" href="classrlModbus.html#a7f0fa2807658c4fd4b7fe0a582f8c386">buf2int_ascii</a>(&amp;telptr[len]);     len += 2;</div>
<div class="line">          }</div>
<div class="line">          data[idata] = 0x0ff; <span class="comment">// terminator, this data can&#39;t come over modbus</span></div>
<div class="line">          <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#ad9c8ac435545e9f724bd905c1db49f28">LRCerror</a>(len) == 1) <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989a7e0314efdf6912fcc42895797b03f6fa">MODBUS_CHECKSUM_ERROR</a>;</div>
<div class="line">          <span class="keywordflow">return</span> byte_count;</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a9b5d2f1cde4cb8de72946073a21a9806">ReadExceptionStatus</a>:</div>
<div class="line">          byte_count = 2;</div>
<div class="line">          <span class="keywordflow">for</span>(idata=0; idata&lt;(byte_count/2); idata++)</div>
<div class="line">          {</div>
<div class="line">            data[idata] = <a class="code" href="classrlModbus.html#a7f0fa2807658c4fd4b7fe0a582f8c386">buf2int_ascii</a>(&amp;telptr[len]);     len += 2;</div>
<div class="line">          }</div>
<div class="line">          data[idata] = 0x0ff; <span class="comment">// terminator, this data can&#39;t come over modbus</span></div>
<div class="line">          <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#ad9c8ac435545e9f724bd905c1db49f28">LRCerror</a>(len) == 1) <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989a7e0314efdf6912fcc42895797b03f6fa">MODBUS_CHECKSUM_ERROR</a>;</div>
<div class="line">          <span class="keywordflow">return</span> byte_count;</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a35c8bfdb88eecf8e49d0fadfc7eaa237">MaskWrite4XRegisters</a>:</div>
<div class="line">          byte_count = 12;</div>
<div class="line">          <span class="keywordflow">for</span>(idata=0; idata&lt;(byte_count/2); idata++)</div>
<div class="line">          {</div>
<div class="line">            data[idata] = <a class="code" href="classrlModbus.html#a7f0fa2807658c4fd4b7fe0a582f8c386">buf2int_ascii</a>(&amp;telptr[len]);     len += 2;</div>
<div class="line">          }</div>
<div class="line">          data[idata] = 0x0ff; <span class="comment">// terminator, this data can&#39;t come over modbus</span></div>
<div class="line">          <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#ad9c8ac435545e9f724bd905c1db49f28">LRCerror</a>(len) == 1) <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989a7e0314efdf6912fcc42895797b03f6fa">MODBUS_CHECKSUM_ERROR</a>;</div>
<div class="line">          <span class="keywordflow">return</span> byte_count;</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657afa0a0876504de7552e05ce9516cba94d">ReadFifoQueue</a>:</div>
<div class="line">          sscanf((<span class="keywordtype">char</span> *) &amp;telptr[len],<span class="stringliteral">&quot;%04X&quot;</span>,&amp;byte_count); len += 4;</div>
<div class="line">          <span class="keywordflow">for</span>(idata=0; idata&lt;(byte_count/2); idata++)</div>
<div class="line">          {</div>
<div class="line">            data[idata] = <a class="code" href="classrlModbus.html#a7f0fa2807658c4fd4b7fe0a582f8c386">buf2int_ascii</a>(&amp;telptr[len]);     len += 2;</div>
<div class="line">          }</div>
<div class="line">          data[idata] = 0x0ff; <span class="comment">// terminator, this data can&#39;t come over modbus</span></div>
<div class="line">          <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#ad9c8ac435545e9f724bd905c1db49f28">LRCerror</a>(len) == 1) <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989a7e0314efdf6912fcc42895797b03f6fa">MODBUS_CHECKSUM_ERROR</a>;</div>
<div class="line">          <span class="keywordflow">return</span> byte_count;</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">          <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#aa6a054b45000251c837abd658ef03339">mode</a> == <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989abd970eee924a7c780af05ab79bf94231">MODBUS_RTU</a>)</div>
<div class="line">    {</div>
<div class="line">      ret = <a class="code" href="classrlModbus.html#ada836e7daccef09a72c3bf782451e160">tty</a>-&gt;<a class="code" href="classrlSerial.html#ad501686172ab403de1585a7a7e0bf5cd">select</a>(timeout);</div>
<div class="line">      <span class="keywordflow">if</span>(ret == 0)                             <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">      <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#ada836e7daccef09a72c3bf782451e160">tty</a>-&gt;<a class="code" href="classrlSerial.html#a4bd5a244a78c06b17976f13ef93aaf54">readBlock</a>(<a class="code" href="classrlModbus.html#a8b8d2c8ccd15c70b3313b914b9252c09">tel</a>, 2, timeout) &lt;= 0) <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">      *slave     = <a class="code" href="classrlModbus.html#a8b8d2c8ccd15c70b3313b914b9252c09">tel</a>[len++];</div>
<div class="line">      *<span class="keyword">function</span>  = <a class="code" href="classrlModbus.html#a8b8d2c8ccd15c70b3313b914b9252c09">tel</a>[len++];</div>
<div class="line">      <span class="keywordflow">switch</span>(*<span class="keyword">function</span>)</div>
<div class="line">      {</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657ad104f9632c5253ab7a9da0bbfe123e88">ReadCoilStatus</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657af76896036e7b31809af71efc96e02c68">ReadInputStatus</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657afbc16bd1a560babc7abcecd6c17a792d">ReadHoldingRegisters</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a4264060e1f2bed5ce560206edad22d6c">ReadInputRegisters</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a0777ef09e8622d6ce0113f11c8c3929e">FetchCommEventLog</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657ae33cbee198a6bfcc56eef4485b365016">ReportSlaveID</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a3c07ffeaae29454fc00ab73774be136e">ReadGeneralReference</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657ad98842ba604a74afa38555c260bb284a">WriteGeneralReference</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a9b7a98765b8b1695533cab836f7cd7b6">ReadWrite4XRegisters</a>:</div>
<div class="line">          <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#ada836e7daccef09a72c3bf782451e160">tty</a>-&gt;<a class="code" href="classrlSerial.html#ad501686172ab403de1585a7a7e0bf5cd">select</a>(timeout) == 0)                        <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">          <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#ada836e7daccef09a72c3bf782451e160">tty</a>-&gt;<a class="code" href="classrlSerial.html#a4bd5a244a78c06b17976f13ef93aaf54">readBlock</a>(&amp;<a class="code" href="classrlModbus.html#a8b8d2c8ccd15c70b3313b914b9252c09">tel</a>[len], 1, timeout) &lt;= 0)       <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">          byte_count = <a class="code" href="classrlModbus.html#a8b8d2c8ccd15c70b3313b914b9252c09">tel</a>[len++];</div>
<div class="line">          <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#ada836e7daccef09a72c3bf782451e160">tty</a>-&gt;<a class="code" href="classrlSerial.html#ad501686172ab403de1585a7a7e0bf5cd">select</a>(timeout) == 0)                        <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">          <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#ada836e7daccef09a72c3bf782451e160">tty</a>-&gt;<a class="code" href="classrlSerial.html#a4bd5a244a78c06b17976f13ef93aaf54">readBlock</a>(data, byte_count+2, timeout) &lt;= 0) <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">          memcpy(&amp;<a class="code" href="classrlModbus.html#a8b8d2c8ccd15c70b3313b914b9252c09">tel</a>[len],data,byte_count+2); len += byte_count + 2;</div>
<div class="line">          <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#af960ac56c12c00e7dd2ce0a3c3fbfb1e">CRCerror</a>(len) == 1)                      <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989a7e0314efdf6912fcc42895797b03f6fa">MODBUS_CHECKSUM_ERROR</a>;</div>
<div class="line">          <span class="keywordflow">return</span> byte_count;</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a885ab1a9d24d8e05107d3558ebd3e3fe">ForceSingleCoil</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a4af03846c50ff298649fefee8087e8ed">PresetSingleRegister</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a1466463ec93749a854bfb0ce85e2acc7">FetchCommEventCtr</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a21384c6826ad985c85bbda6e22d93043">ForceMultipleCoils</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a485fed5b1927d6bf0db7311e76136fb0">PresetMultipleRegs</a>:</div>
<div class="line">          byte_count = 4;</div>
<div class="line">          <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#ada836e7daccef09a72c3bf782451e160">tty</a>-&gt;<a class="code" href="classrlSerial.html#ad501686172ab403de1585a7a7e0bf5cd">select</a>(timeout) == 0)                        <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">          <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#ada836e7daccef09a72c3bf782451e160">tty</a>-&gt;<a class="code" href="classrlSerial.html#a4bd5a244a78c06b17976f13ef93aaf54">readBlock</a>(data, byte_count+2, timeout) &lt;= 0) <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">          memcpy(&amp;<a class="code" href="classrlModbus.html#a8b8d2c8ccd15c70b3313b914b9252c09">tel</a>[len],data,byte_count+2); len += byte_count + 2;</div>
<div class="line">          <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#af960ac56c12c00e7dd2ce0a3c3fbfb1e">CRCerror</a>(len) == 1)                      <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989a7e0314efdf6912fcc42895797b03f6fa">MODBUS_CHECKSUM_ERROR</a>;</div>
<div class="line">          <span class="keywordflow">return</span> byte_count;</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a9b5d2f1cde4cb8de72946073a21a9806">ReadExceptionStatus</a>:</div>
<div class="line">          byte_count = 1;</div>
<div class="line">          <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#ada836e7daccef09a72c3bf782451e160">tty</a>-&gt;<a class="code" href="classrlSerial.html#ad501686172ab403de1585a7a7e0bf5cd">select</a>(timeout) == 0)                        <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">          <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#ada836e7daccef09a72c3bf782451e160">tty</a>-&gt;<a class="code" href="classrlSerial.html#a4bd5a244a78c06b17976f13ef93aaf54">readBlock</a>(data, byte_count+2, timeout) &lt;= 0) <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">          memcpy(&amp;<a class="code" href="classrlModbus.html#a8b8d2c8ccd15c70b3313b914b9252c09">tel</a>[len],data,byte_count+2); len += byte_count + 2;</div>
<div class="line">          <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#af960ac56c12c00e7dd2ce0a3c3fbfb1e">CRCerror</a>(len) == 1)                      <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989a7e0314efdf6912fcc42895797b03f6fa">MODBUS_CHECKSUM_ERROR</a>;</div>
<div class="line">          <span class="keywordflow">return</span> byte_count;</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657a35c8bfdb88eecf8e49d0fadfc7eaa237">MaskWrite4XRegisters</a>:</div>
<div class="line">          byte_count = 6;</div>
<div class="line">          <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#ada836e7daccef09a72c3bf782451e160">tty</a>-&gt;<a class="code" href="classrlSerial.html#ad501686172ab403de1585a7a7e0bf5cd">select</a>(timeout) == 0)                        <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">          <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#ada836e7daccef09a72c3bf782451e160">tty</a>-&gt;<a class="code" href="classrlSerial.html#a4bd5a244a78c06b17976f13ef93aaf54">readBlock</a>(data, byte_count+2, timeout) &lt;= 0) <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">          memcpy(&amp;<a class="code" href="classrlModbus.html#a8b8d2c8ccd15c70b3313b914b9252c09">tel</a>[len],data,byte_count+2); len += byte_count + 2;</div>
<div class="line">          <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#af960ac56c12c00e7dd2ce0a3c3fbfb1e">CRCerror</a>(len) == 1)                      <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989a7e0314efdf6912fcc42895797b03f6fa">MODBUS_CHECKSUM_ERROR</a>;</div>
<div class="line">          <span class="keywordflow">return</span> byte_count;</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code" href="classrlModbus.html#af220cecff330a69323f040b1c239c657afa0a0876504de7552e05ce9516cba94d">ReadFifoQueue</a>:</div>
<div class="line">          <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#ada836e7daccef09a72c3bf782451e160">tty</a>-&gt;<a class="code" href="classrlSerial.html#ad501686172ab403de1585a7a7e0bf5cd">select</a>(timeout) == 0)                        <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">          <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#ada836e7daccef09a72c3bf782451e160">tty</a>-&gt;<a class="code" href="classrlSerial.html#a4bd5a244a78c06b17976f13ef93aaf54">readBlock</a>(&amp;<a class="code" href="classrlModbus.html#a8b8d2c8ccd15c70b3313b914b9252c09">tel</a>[len], 2, timeout) &lt;= 0)       <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">          byte_count = <a class="code" href="classrlModbus.html#a8b8d2c8ccd15c70b3313b914b9252c09">tel</a>[len]*256 + <a class="code" href="classrlModbus.html#a8b8d2c8ccd15c70b3313b914b9252c09">tel</a>[len+1]; len += 2;</div>
<div class="line">          <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#ada836e7daccef09a72c3bf782451e160">tty</a>-&gt;<a class="code" href="classrlSerial.html#ad501686172ab403de1585a7a7e0bf5cd">select</a>(timeout) == 0)                        <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">          <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#ada836e7daccef09a72c3bf782451e160">tty</a>-&gt;<a class="code" href="classrlSerial.html#a4bd5a244a78c06b17976f13ef93aaf54">readBlock</a>(data, byte_count+2, timeout) &lt;= 0) <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">          memcpy(&amp;tel[len],data,byte_count+2); len += byte_count + 2;</div>
<div class="line">          <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#af960ac56c12c00e7dd2ce0a3c3fbfb1e">CRCerror</a>(len) == 1)                      <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989a7e0314efdf6912fcc42895797b03f6fa">MODBUS_CHECKSUM_ERROR</a>;</div>
<div class="line">          <span class="keywordflow">return</span> byte_count;</div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">          <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">else</span> <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">  <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ae5c1eaaf0071d082751fcdcfa624e52f">MODBUS_SUCCESS</a>;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a7efc504fc4759fc04add6b33d64bf28c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int rlModbus::write </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>slave</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>function</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned char *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>transactionID</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="rlmodbus_8cpp_source.html#l00054">54</a> of file <a class="el" href="rlmodbus_8cpp_source.html">rlmodbus.cpp</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  <span class="keywordtype">int</span> len,i;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>(slave &lt; 0 || slave &gt; 255) <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">  len = 0;</div>
<div class="line">  <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#aa6a054b45000251c837abd658ef03339">mode</a> == <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab29d44112460cd074cbaa194b98c8a90">MODBUS_ASCII</a>)</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classrlModbus.html#a8b8d2c8ccd15c70b3313b914b9252c09">tel</a>[len++] = <span class="charliteral">&#39;:&#39;</span>;</div>
<div class="line">    sprintf((<span class="keywordtype">char</span> *) &amp;<a class="code" href="classrlModbus.html#a8b8d2c8ccd15c70b3313b914b9252c09">tel</a>[len], <span class="stringliteral">&quot;%02X&quot;</span>, slave);          len += 2;</div>
<div class="line">    sprintf((<span class="keywordtype">char</span> *) &amp;<a class="code" href="classrlModbus.html#a8b8d2c8ccd15c70b3313b914b9252c09">tel</a>[len], <span class="stringliteral">&quot;%02X&quot;</span>, <span class="keyword">function</span>);       len += 2;</div>
<div class="line">    <span class="keywordflow">for</span>(i=0; i&lt;datalen; i++)</div>
<div class="line">    {</div>
<div class="line">      sprintf((<span class="keywordtype">char</span> *) &amp;<a class="code" href="classrlModbus.html#a8b8d2c8ccd15c70b3313b914b9252c09">tel</a>[len], <span class="stringliteral">&quot;%02X&quot;</span>,(<span class="keywordtype">int</span>) data[i]); len += 2;</div>
<div class="line">      <span class="keywordflow">if</span>((len+4) &gt; <a class="code" href="classrlModbus.html#a0404de78dcd9182a39be0f7ffe23b19c">maxtel</a>) <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">    }</div>
<div class="line">    <a class="code" href="classrlModbus.html#a7fcc08ea7c9efff7529d5e9ceb5722b2">insertLRC</a>(len);                                     len += 2;</div>
<div class="line">    <a class="code" href="classrlModbus.html#a8b8d2c8ccd15c70b3313b914b9252c09">tel</a>[len++] = 0x0d;</div>
<div class="line">    <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#a9777d76fbc901e32d03bbc86ca557842">delimitor</a> == 0x0a) <a class="code" href="classrlModbus.html#a8b8d2c8ccd15c70b3313b914b9252c09">tel</a>[len++] = 0x0a;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#aa6a054b45000251c837abd658ef03339">mode</a> == <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989abd970eee924a7c780af05ab79bf94231">MODBUS_RTU</a>)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#add9b1e7cbb325c771bdfe1ebf780d3b5">s</a> != NULL)</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordflow">if</span>(transactionID == NULL)</div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="classrlModbus.html#a8b8d2c8ccd15c70b3313b914b9252c09">tel</a>[len++] = 0;       <span class="comment">// bytes 0,1 Transaction ID. Not important. Usually zero when making a request, the server will copy them faithfully into the response.</span></div>
<div class="line">        <a class="code" href="classrlModbus.html#a8b8d2c8ccd15c70b3313b914b9252c09">tel</a>[len++] = 0;</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">else</span></div>
<div class="line">      {</div>
<div class="line">        <a class="code" href="classrlModbus.html#a8b8d2c8ccd15c70b3313b914b9252c09">tel</a>[len++] = ((*transactionID) &amp; 0xFF00) / 256;         <span class="comment">// bytes 0,1 Transaction ID.</span></div>
<div class="line">        <a class="code" href="classrlModbus.html#a8b8d2c8ccd15c70b3313b914b9252c09">tel</a>[len++] = (*transactionID) &amp; 0xFF;</div>
<div class="line">      }</div>
<div class="line">      <a class="code" href="classrlModbus.html#a8b8d2c8ccd15c70b3313b914b9252c09">tel</a>[len++] = 0;         <span class="comment">// bytes 2,3 Protocol number. Must be zero.</span></div>
<div class="line">      <a class="code" href="classrlModbus.html#a8b8d2c8ccd15c70b3313b914b9252c09">tel</a>[len++] = 0;</div>
<div class="line">      <a class="code" href="classrlModbus.html#a8b8d2c8ccd15c70b3313b914b9252c09">tel</a>[len++] = 0;         <span class="comment">// byte 4 Length (upper byte). Since all requests will be less than 256 bytes in length (!), this will always be zero.</span></div>
<div class="line">      <a class="code" href="classrlModbus.html#a8b8d2c8ccd15c70b3313b914b9252c09">tel</a>[len++] = 2+datalen; <span class="comment">// byte 5 Length (lower byte). Equal to the number of bytes which follow</span></div>
<div class="line">    }</div>
<div class="line">    <a class="code" href="classrlModbus.html#a8b8d2c8ccd15c70b3313b914b9252c09">tel</a>[len++] = (<span class="keywordtype">unsigned</span> char) slave;</div>
<div class="line">    <a class="code" href="classrlModbus.html#a8b8d2c8ccd15c70b3313b914b9252c09">tel</a>[len++] = (<span class="keywordtype">unsigned</span> char) <span class="keyword">function</span>;</div>
<div class="line">    <span class="keywordflow">for</span>(i=0; i&lt;datalen; i++)</div>
<div class="line">    {</div>
<div class="line">      <a class="code" href="classrlModbus.html#a8b8d2c8ccd15c70b3313b914b9252c09">tel</a>[len++] = data[i];</div>
<div class="line">      <span class="keywordflow">if</span>((len+2) &gt; <a class="code" href="classrlModbus.html#a0404de78dcd9182a39be0f7ffe23b19c">maxtel</a>) <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">    }</div>
<div class="line">    <a class="code" href="classrlModbus.html#af22f8da932f8c51dc584596f2e7e4d47">insertCRC</a>(len);                                     len += 2;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">else</span> <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#add9b1e7cbb325c771bdfe1ebf780d3b5">s</a> != NULL)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#add9b1e7cbb325c771bdfe1ebf780d3b5">s</a>-&gt;<a class="code" href="classrlSocket.html#a4ca3288e228e58fe41e9e64ad1c0ed6a">isConnected</a>() == 0)</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#a5d323c81b0dac5fd991fd28e9fb3ac80">autoreconnectSocket</a>) <a class="code" href="classrlModbus.html#add9b1e7cbb325c771bdfe1ebf780d3b5">s</a>-&gt;<a class="code" href="classrlSocket.html#ad30990162e716dce512116d9336de89e">connect</a>();</div>
<div class="line">      <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#add9b1e7cbb325c771bdfe1ebf780d3b5">s</a>-&gt;<a class="code" href="classrlSocket.html#a4ca3288e228e58fe41e9e64ad1c0ed6a">isConnected</a>() == 0) <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#add9b1e7cbb325c771bdfe1ebf780d3b5">s</a>-&gt;<a class="code" href="classrlSocket.html#aa069e328b2509cbbc15bf9c91684b6be">write</a>(<a class="code" href="classrlModbus.html#a8b8d2c8ccd15c70b3313b914b9252c09">tel</a>,len-2) &lt; 0) <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>; <span class="comment">// don&#39;t send LRC or CRC</span></div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#ada836e7daccef09a72c3bf782451e160">tty</a> != NULL)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">if</span>(<a class="code" href="classrlModbus.html#ada836e7daccef09a72c3bf782451e160">tty</a>-&gt;<a class="code" href="classrlSerial.html#ac2bb1e98663afb459719ee0b4a2233a0">writeBlock</a>(<a class="code" href="classrlModbus.html#a8b8d2c8ccd15c70b3313b914b9252c09">tel</a>,len) &lt; 0) <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">else</span> <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ab45e13188681f45972781de86f9fe60a">MODBUS_ERROR</a>;</div>
<div class="line">  <span class="keywordflow">return</span> <a class="code" href="classrlModbus.html#a359c129c50db845b9f57181ea1132989ae5c1eaaf0071d082751fcdcfa624e52f">MODBUS_SUCCESS</a>;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="a5d323c81b0dac5fd991fd28e9fb3ac80"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int rlModbus::autoreconnectSocket</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="rlmodbus_8h_source.html#l00072">72</a> of file <a class="el" href="rlmodbus_8h_source.html">rlmodbus.h</a>.</p>

</div>
</div>
<a class="anchor" id="a9777d76fbc901e32d03bbc86ca557842"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">char rlModbus::delimitor</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="rlmodbus_8h_source.html#l00088">88</a> of file <a class="el" href="rlmodbus_8h_source.html">rlmodbus.h</a>.</p>

</div>
</div>
<a class="anchor" id="a0404de78dcd9182a39be0f7ffe23b19c"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">long rlModbus::maxtel</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="rlmodbus_8h_source.html#l00086">86</a> of file <a class="el" href="rlmodbus_8h_source.html">rlmodbus.h</a>.</p>

</div>
</div>
<a class="anchor" id="aa6a054b45000251c837abd658ef03339"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int rlModbus::mode</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="rlmodbus_8h_source.html#l00087">87</a> of file <a class="el" href="rlmodbus_8h_source.html">rlmodbus.h</a>.</p>

</div>
</div>
<a class="anchor" id="add9b1e7cbb325c771bdfe1ebf780d3b5"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classrlSocket.html">rlSocket</a>* rlModbus::s</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="rlmodbus_8h_source.html#l00083">83</a> of file <a class="el" href="rlmodbus_8h_source.html">rlmodbus.h</a>.</p>

</div>
</div>
<a class="anchor" id="a8b8d2c8ccd15c70b3313b914b9252c09"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unsigned char* rlModbus::tel</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="rlmodbus_8h_source.html#l00085">85</a> of file <a class="el" href="rlmodbus_8h_source.html">rlmodbus.h</a>.</p>

</div>
</div>
<a class="anchor" id="ada836e7daccef09a72c3bf782451e160"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classrlSerial.html">rlSerial</a>* rlModbus::tty</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="rlmodbus_8h_source.html#l00084">84</a> of file <a class="el" href="rlmodbus_8h_source.html">rlmodbus.h</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="rlmodbus_8h_source.html">rlmodbus.h</a></li>
<li><a class="el" href="rlmodbus_8cpp_source.html">rlmodbus.cpp</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.1
</small></address>
</body>
</html>
